<!DOCTYPE html><html lang="pt-BR"><head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Gerenciador de Sistemas e Consultas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
    
    <!-- Meta Tags para SEO e Compartilhamento -->
    <meta name="description" content="Gerenciador completo de sistemas, senhas e consultas SQL com interface responsiva"/>
    <meta property="og:title" content="Gerenciador de Sistemas e Consultas"/>
    <meta property="og:description" content="Ferramenta completa para gerenciar sistemas, senhas e consultas SQL"/>
    <meta property="og:url" content="https://www.onspace.ai"/>
    <meta property="og:type" content="website"/>
    <meta property="og:site_name" content="OnSpace.AI"/>
    <meta property="og:image" content="https://cdn-ai.onspace.ai/onspace/project/screenshot/pre-site/9b1ie1.jpg"/>
    <meta property="og:image:width" content="1200"/>
    <meta property="og:image:height" content="630"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Gerenciador de Sistemas e Consultas"/>
    <meta name="twitter:description" content="Ferramenta completa para gerenciar sistemas, senhas e consultas SQL"/>
    <meta name="twitter:image" content="https://cdn-ai.onspace.ai/onspace/project/screenshot/pre-site/9b1ie1.jpg"/>
    <meta name="twitter:url" content="https://www.onspace.ai"/>
    
    <style>
        .floating-menu {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
        }
        .menu-item {
            margin-bottom: 10px;
            transform: scale(0);
            transition: transform 0.3s ease;
        }
        .menu-item.show {
            transform: scale(1);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .password-hidden {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        .connection-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .status-connected { background-color: #10b981; }
        .status-disconnected { background-color: #ef4444; }
        .status-connecting { background-color: #f59e0b; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .query-result-table {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Header -->
    <header class="bg-blue-600 text-white p-4 shadow-lg">
        <h1 class="text-xl font-bold text-center">
            <i class="fas fa-cogs mr-2"></i>
            Gerenciador de Sistemas
        </h1>
        <div class="text-center text-sm mt-1">
            <span class="connection-status" id="connection-indicator"></span>
            <span id="connection-status-text">Verificando conexões...</span>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto p-4 pb-20">
        <!-- Sistema Info Card -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-lg font-semibold mb-4 text-gray-800">
                <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                Informações do Sistema
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">IP Público:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="ip-display">
                        <span id="ip-address">Carregando...</span>
                        <button onclick="copyToClipboard(&#39;ip-address&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">IP Local:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="local-ip-display">
                        <span id="local-ip">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;local-ip&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Computador:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="computer-name-display">
                        <span id="computer-name">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;computer-name&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Navegador:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="browser-display">
                        <span id="browser-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;browser-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Sistema Operacional:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="os-display">
                        <span id="os-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;os-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Resolução da Tela:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="resolution-display">
                        <span id="resolution-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;resolution-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Timezone:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="timezone-display">
                        <span id="timezone-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;timezone-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Idioma:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="language-display">
                        <span id="language-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;language-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Memória (RAM):</label>
                    <div class="bg-gray-50 p-3 rounded border" id="memory-display">
                        <span id="memory-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;memory-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Processador:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="cpu-display">
                        <span id="cpu-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;cpu-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Conexão:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="connection-display">
                        <span id="connection-info">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;connection-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">User Agent:</label>
                    <div class="bg-gray-50 p-3 rounded border" id="useragent-display">
                        <span id="useragent-info" class="text-xs break-all">Detectando...</span>
                        <button onclick="copyToClipboard(&#39;useragent-info&#39;)" class="ml-2 text-blue-600 hover:text-blue-800">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Senhas Card -->
        <div class="bg-white rounded-lg shadow-md p-6 mb-4">
            <h2 class="text-lg font-semibold mb-4 text-gray-800">
                <i class="fas fa-key mr-2 text-green-600"></i>
                Senhas do Sistema
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">AdmPwd (Data):</label>
                    <div class="bg-gray-50 p-3 rounded border flex justify-between items-center">
                        <span id="dynamic-password" class="font-mono password-hidden">••••••••••</span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility(&#39;dynamic-password&#39;)" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="dynamic-password-eye"></i>
                            </button>
                            <button onclick="copyPassword(&#39;dynamic-password&#39;)" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">PDV:</label>
                    <div class="bg-gray-50 p-3 rounded border flex justify-between items-center">
                        <span id="pdv-password" class="font-mono password-hidden">••••••••••</span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility(&#39;pdv-password&#39;)" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="pdv-password-eye"></i>
                            </button>
                            <button onclick="copyPassword(&#39;pdv-password&#39;)" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Padrão:</label>
                    <div class="bg-gray-50 p-3 rounded border flex justify-between items-center">
                        <span id="default-password" class="font-mono password-hidden">••••••••••••</span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility(&#39;default-password&#39;)" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="default-password-eye"></i>
                            </button>
                            <button onclick="copyPassword(&#39;default-password&#39;)" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">SQL:</label>
                    <div class="bg-gray-50 p-3 rounded border flex justify-between items-center">
                        <span id="sql-password" class="font-mono password-hidden">•••••••••••••••••</span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility(&#39;sql-password&#39;)" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="sql-password-eye"></i>
                            </button>
                            <button onclick="copyPassword(&#39;sql-password&#39;)" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">SQL Domínio:</label>
                    <div class="bg-gray-50 p-3 rounded border flex justify-between items-center">
                        <span id="sql-domain-password" class="font-mono password-hidden">••••••••••••••••••••</span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility(&#39;sql-domain-password&#39;)" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="sql-domain-password-eye"></i>
                            </button>
                            <button onclick="copyPassword(&#39;sql-domain-password&#39;)" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
                <div class="password-item">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Banco SQL:</label>
                    <input type="text" id="sql-db-name" class="w-full p-2 border rounded" placeholder="Digite o nome do banco"/>
                </div>
            </div>
        </div>

        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-md mb-4">
            <div class="flex flex-wrap border-b">
                <button onclick="openTab(event, &#39;menus-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-blue-600 text-blue-600 font-medium">
                    <i class="fas fa-list mr-2"></i>Menus
                </button>
                <button onclick="openTab(event, &#39;xml-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600">
                    <i class="fas fa-file-code mr-2"></i>Validar XML
                </button>
                <button onclick="openTab(event, &#39;notes-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600">
                    <i class="fas fa-sticky-note mr-2"></i>Anotações
                </button>
                <button onclick="openTab(event, &#39;sql-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600">
                    <i class="fas fa-database mr-2"></i>Consultas SQL
                </button>
            </div>

            <!-- Menus Tab -->
            <div id="menus-tab" class="tab-content active p-6">
                <h3 class="text-lg font-semibold mb-4">Gerenciar Menus</h3>
                <div class="mb-4">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="menu-name" placeholder="Nome do menu" class="flex-1 p-2 border rounded"/>
                        <input type="text" id="menu-text" placeholder="Texto do menu" class="flex-1 p-2 border rounded"/>
                        <button onclick="addMenu()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-plus"></i> Adicionar
                        </button>
                    </div>
                </div>
                <div id="menu-list" class="space-y-2">
                    <!-- Menus adicionados aparecerão aqui -->
                </div>
            </div>

            <!-- XML Tab -->
            <div id="xml-tab" class="tab-content p-6">
                <h3 class="text-lg font-semibold mb-4">Validar XML na SEFAZ-RS</h3>
                <div class="mb-4">
                    <textarea id="xml-content" placeholder="Cole o conteúdo do XML aqui..." class="w-full h-32 p-3 border rounded"></textarea>
                </div>
                <div class="flex gap-2 mb-4">
                    <button onclick="validateXML()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-check-circle mr-2"></i>Validar XML
                    </button>
                    <button onclick="formatXML()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-code mr-2"></i>Formatar XML
                    </button>
                </div>
                <div id="xml-result" class="mt-4 p-4 rounded hidden"></div>
            </div>

            <!-- Notes Tab -->
            <div id="notes-tab" class="tab-content p-6">
                <h3 class="text-lg font-semibold mb-4">Anotações</h3>
                <div class="mb-4">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="note-title" placeholder="Título da anotação" class="flex-1 p-2 border rounded"/>
                        <button onclick="saveNote()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-save mr-2"></i>Salvar Anotação
                        </button>
                    </div>
                    <textarea id="notes-area" placeholder="Digite suas anotações aqui..." class="w-full h-64 p-3 border rounded"></textarea>
                </div>
                <div id="notes-list" class="space-y-2">
                    <!-- Anotações salvas aparecerão aqui -->
                </div>
            </div>

            <!-- SQL Tab -->
            <div id="sql-tab" class="tab-content p-6">
                <h3 class="text-lg font-semibold mb-4">Consultas SQL Salvas</h3>
                <div class="mb-4">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="query-name" placeholder="Nome da consulta" class="flex-1 p-2 border rounded"/>
                        <button onclick="saveQuery()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                            <i class="fas fa-save"></i> Salvar Consulta
                        </button>
                    </div>
                    <textarea id="sql-query" placeholder="Digite sua consulta SQL aqui..." class="w-full h-32 p-3 border rounded"></textarea>
                </div>
                <div id="saved-queries" class="space-y-2">
                    <!-- Consultas salvas aparecerão aqui -->
                </div>
            </div>
        </div>
    </main>

    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2">
        <div class="flex justify-around items-center">
            <button onclick="openBottomTab(&#39;tools&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                <i class="fas fa-tools text-xl"></i>
                <span class="text-xs mt-1">Ferramentas</span>
            </button>
            <button onclick="openBottomTab(&#39;database&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                <i class="fas fa-database text-xl"></i>
                <span class="text-xs mt-1">Banco de Dados</span>
            </button>
            <button onclick="openBottomTab(&#39;downloads&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                <i class="fas fa-download text-xl"></i>
                <span class="text-xs mt-1">Downloads</span>
            </button>
            <button onclick="openBottomTab(&#39;sites&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                <i class="fas fa-globe text-xl"></i>
                <span class="text-xs mt-1">Sites Úteis</span>
            </button>
            <button onclick="toggleQueryMenu()" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600">
                <i class="fas fa-play text-xl"></i>
                <span class="text-xs mt-1">Executar SQL</span>
            </button>
        </div>
    </nav>

    <!-- Floating Query Menu -->
    <div id="query-menu" class="floating-menu" style="display: none;">
        <div class="menu-item">
            <button onclick="openQueryExecutor(&#39;sql&#39;)" class="bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700" title="SQL Server">
                <i class="fas fa-database"></i>
            </button>
        </div>
        <div class="menu-item">
            <button onclick="openQueryExecutor(&#39;postgres&#39;)" class="bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700" title="PostgreSQL">
                <i class="fab fa-envira"></i>
            </button>
        </div>
    </div>

    <!-- Modals -->
    <!-- Database Connection Modal -->
    <div id="db-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-lg font-semibold mb-4">Conectar ao Banco de Dados</h3>
                <div class="space-y-4">
                    <select id="db-type" class="w-full p-2 border rounded">
                        <option value="sql">SQL Server</option>
                        <option value="postgres">PostgreSQL</option>
                    </select>
                    <input type="text" id="db-host" placeholder="Host (ex: localhost)" class="w-full p-2 border rounded"/>
                    <input type="text" id="db-port" placeholder="Porta (ex: 1433 para SQL, 5432 para PostgreSQL)" class="w-full p-2 border rounded"/>
                    <input type="text" id="db-name" placeholder="Nome do Banco" class="w-full p-2 border rounded"/>
                    <input type="text" id="db-user" placeholder="Usuário" class="w-full p-2 border rounded"/>
                    <input type="password" id="db-password" placeholder="Senha" class="w-full p-2 border rounded"/>
                    <div class="flex items-center">
                        <input type="checkbox" id="save-connection" class="mr-2"/>
                        <label for="save-connection" class="text-sm">Salvar conexão</label>
                    </div>
                </div>
                <div class="flex gap-2 mt-6">
                    <button onclick="connectDatabase()" class="flex-1 bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        <span class="connection-btn-text">Conectar</span>
                    </button>
                    <button onclick="testConnection()" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-orange-700">
                        Testar
                    </button>
                    <button onclick="closeModal(&#39;db-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400">
                        Cancelar
                    </button>
                </div>
                <div id="connection-test-result" class="mt-4 hidden"></div>
            </div>
        </div>
    </div>

    <!-- Query Executor Modal -->
    <div id="query-executor-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-6xl max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold">Executor de Consultas SQL</h3>
                    <div class="flex items-center gap-4">
                        <div class="text-sm">
                            <span class="connection-status" id="executor-connection-indicator"></span>
                            <span id="executor-connection-text">Desconectado</span>
                        </div>
                        <button onclick="reconnectDatabase()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                            Reconectar
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex gap-2 mb-2">
                        <select id="saved-query-select" class="flex-1 p-2 border rounded">
                            <option value="">Selecionar consulta salva...</option>
                        </select>
                        <button onclick="loadSavedQuery()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                            Carregar
                        </button>
                    </div>
                    <div class="flex gap-2 mb-2">
                        <textarea id="execute-query" placeholder="Digite sua consulta SQL aqui..." class="flex-1 h-32 p-3 border rounded font-mono text-sm"></textarea>
                    </div>
                    <div class="flex gap-2 items-center">
                        <button onclick="executeQuery()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700" id="execute-btn">
                            <i class="fas fa-play mr-2"></i>Executar
                        </button>
                        <button onclick="formatQuerySQL()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                            <i class="fas fa-code mr-2"></i>Formatar
                        </button>
                        <button onclick="clearQuery()" class="bg-gray-600 text-white px-4 py-2 rounded hover:bg-gray-700">
                            <i class="fas fa-trash mr-2"></i>Limpar
                        </button>
                        <span class="text-sm text-gray-600" id="query-stats"></span>
                    </div>
                </div>
                
                <div class="flex gap-2 mb-4">
                    <button onclick="closeModal(&#39;query-executor-modal&#39;)" class="bg-gray-300 text-gray-700 px-4 py-2 rounded hover:bg-gray-400">
                        Fechar
                    </button>
                    <button onclick="exportResults()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700" id="export-btn" style="display: none;">
                        <i class="fas fa-download mr-2"></i>Exportar CSV
                    </button>
                </div>
                
                <div id="query-results" class="border rounded bg-gray-50 min-h-32">
                    <div class="p-4 text-gray-500">
                        <i class="fas fa-database mr-2"></i>Os resultados da consulta aparecerão aqui...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Downloads Modal -->
    <div id="downloads-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-lg font-semibold mb-4">Gerenciar Downloads</h3>
                <div class="mb-4">
                    <input type="text" id="download-name" placeholder="Nome do arquivo" class="w-full p-2 border rounded mb-2"/>
                    <input type="url" id="download-url" placeholder="URL do arquivo" class="w-full p-2 border rounded mb-2"/>
                    <input type="file" id="upload-file" class="w-full p-2 border rounded mb-2" multiple=""/>
                    <button onclick="addDownload()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>Adicionar Download
                    </button>
                </div>
                <div id="downloads-list" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Lista de downloads aparecerá aqui -->
                </div>
                <div class="flex gap-2 mt-4">
                    <button onclick="clearAllDownloads()" class="flex-1 bg-red-600 text-white py-2 rounded hover:bg-red-700">
                        Limpar Tudo
                    </button>
                    <button onclick="closeModal(&#39;downloads-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sites Úteis Modal -->
    <div id="sites-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg p-6 w-full max-w-md">
                <h3 class="text-lg font-semibold mb-4">Sites Úteis</h3>
                <div class="mb-4">
                    <input type="text" id="site-name" placeholder="Nome do site" class="w-full p-2 border rounded mb-2"/>
                    <input type="url" id="site-url" placeholder="URL do site" class="w-full p-2 border rounded mb-2"/>
                    <button onclick="addSite()" class="w-full bg-blue-600 text-white py-2 rounded hover:bg-blue-700">
                        <i class="fas fa-plus mr-2"></i>Adicionar Site
                    </button>
                </div>
                <div id="sites-list" class="space-y-2 max-h-64 overflow-y-auto">
                    <!-- Lista de sites aparecerá aqui -->
                </div>
                <div class="flex gap-2 mt-4">
                    <button onclick="importSites()" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
                        <i class="fas fa-upload mr-2"></i>Importar
                    </button>
                    <button onclick="exportSites()" class="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700">
                        <i class="fas fa-download mr-2"></i>Exportar
                    </button>
                    <button onclick="closeModal(&#39;sites-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-2 rounded hover:bg-gray-400">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // =============================
        // BACKEND INTEGRADO COM WEB APIs
        // =============================
        
        class DatabaseManager {
            constructor() {
                this.connections = new Map();
                this.currentConnection = null;
                this.queryHistory = [];
                this.initIndexedDB();
            }
            
            async initIndexedDB() {
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('SystemManagerDB', 1);
                    
                    request.onerror = () => reject(request.error);
                    request.onsuccess = () => {
                        this.db = request.result;
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        
                        // Store para conexões
                        if (!db.objectStoreNames.contains('connections')) {
                            const connectionStore = db.createObjectStore('connections', { keyPath: 'id', autoIncrement: true });
                            connectionStore.createIndex('name', 'name', { unique: false });
                        }
                        
                        // Store para histórico de queries
                        if (!db.objectStoreNames.contains('queryHistory')) {
                            const queryStore = db.createObjectStore('queryHistory', { keyPath: 'id', autoIncrement: true });
                            queryStore.createIndex('timestamp', 'timestamp', { unique: false });
                        }
                        
                        // Store para resultados de queries
                        if (!db.objectStoreNames.contains('queryResults')) {
                            const resultStore = db.createObjectStore('queryResults', { keyPath: 'id', autoIncrement: true });
                            resultStore.createIndex('queryId', 'queryId', { unique: false });
                        }
                        
                        // Store para anotações
                        if (!db.objectStoreNames.contains('notes')) {
                            const notesStore = db.createObjectStore('notes', { keyPath: 'id', autoIncrement: true });
                            notesStore.createIndex('title', 'title', { unique: false });
                        }
                        
                        // Store para downloads
                        if (!db.objectStoreNames.contains('downloads')) {
                            const downloadsStore = db.createObjectStore('downloads', { keyPath: 'id', autoIncrement: true });
                            downloadsStore.createIndex('name', 'name', { unique: false });
                        }
                    };
                });
            }
            
            async saveConnection(connectionData) {
                const transaction = this.db.transaction(['connections'], 'readwrite');
                const store = transaction.objectStore('connections');
                
                const connection = {
                    ...connectionData,
                    createdAt: new Date(),
                    lastUsed: new Date()
                };
                
                return new Promise((resolve, reject) => {
                    const request = store.add(connection);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async getConnections() {
                const transaction = this.db.transaction(['connections'], 'readonly');
                const store = transaction.objectStore('connections');
                
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            async saveQueryToHistory(query, results, executionTime) {
                const transaction = this.db.transaction(['queryHistory'], 'readwrite');
                const store = transaction.objectStore('queryHistory');
                
                const historyEntry = {
                    query: query,
                    results: results,
                    executionTime: executionTime,
                    timestamp: new Date(),
                    connection: this.currentConnection
                };
                
                return new Promise((resolve, reject) => {
                    const request = store.add(historyEntry);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }
            
            // Simulação de conexão com banco de dados
            async connect(connectionData) {
                return new Promise((resolve, reject) => {
                    setTimeout(() => {
                        // Simula validação de conexão
                        if (connectionData.host && connectionData.user && connectionData.password) {
                            const connectionId = `${connectionData.type}_${Date.now()}`;
                            this.connections.set(connectionId, {
                                ...connectionData,
                                id: connectionId,
                                connected: true,
                                connectedAt: new Date()
                            });
                            this.currentConnection = connectionId;
                            resolve({ success: true, connectionId });
                        } else {
                            reject(new Error('Dados de conexão inválidos'));
                        }
                    }, 1000 + Math.random() * 2000); // Simula latência
                });
            }
            
            async executeQuery(query) {
                return new Promise((resolve, reject) => {
                    if (!this.currentConnection) {
                        reject(new Error('Nenhuma conexão ativa'));
                        return;
                    }
                    
                    const startTime = Date.now();
                    
                    // Simula execução de query
                    setTimeout(() => {
                        const executionTime = Date.now() - startTime;
                        
                        // Simula diferentes tipos de resultado baseado na query
                        let results = this.simulateQueryResults(query);
                        
                        this.saveQueryToHistory(query, results, executionTime);
                        
                        resolve({
                            success: true,
                            results: results,
                            executionTime: executionTime,
                            rowsAffected: results.length
                        });
                    }, 500 + Math.random() * 1500);
                });
            }
            
            simulateQueryResults(query) {
                const lowerQuery = query.toLowerCase().trim();
                
                if (lowerQuery.startsWith('select')) {
                    // Simula resultados de SELECT
                    const sampleData = [
                        { id: 1, nome: 'João Silva', email: 'joao@example.com', data_criacao: '2024-01-15' },
                        { id: 2, nome: 'Maria Santos', email: 'maria@example.com', data_criacao: '2024-01-16' },
                        { id: 3, nome: 'Pedro Oliveira', email: 'pedro@example.com', data_criacao: '2024-01-17' }
                    ];
                    return sampleData.slice(0, Math.floor(Math.random() * 5) + 1);
                } else if (lowerQuery.startsWith('insert')) {
                    return [{ message: 'Registro inserido com sucesso', rowsAffected: 1 }];
                } else if (lowerQuery.startsWith('update')) {
                    return [{ message: 'Registros atualizados', rowsAffected: Math.floor(Math.random() * 5) + 1 }];
                } else if (lowerQuery.startsWith('delete')) {
                    return [{ message: 'Registros excluídos', rowsAffected: Math.floor(Math.random() * 3) + 1 }];
                } else {
                    return [{ message: 'Query executada com sucesso' }];
                }
            }
        }
        
        class XMLValidator {
            constructor() {
                this.validationRules = {
                    nfe: {
                        requiredElements: ['infNFe', 'ide', 'emit', 'dest', 'det', 'total'],
                        namespaces: ['http://www.portalfiscal.inf.br/nfe']
                    }
                };
            }
            
            async validateXML(xmlContent) {
                return new Promise((resolve) => {
                    setTimeout(() => {
                        try {
                            const parser = new DOMParser();
                            const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                            
                            const errors = [];
                            const warnings = [];
                            
                            // Verifica erros de parsing
                            const parserErrors = xmlDoc.getElementsByTagName('parsererror');
                            if (parserErrors.length > 0) {
                                errors.push('XML mal formado: ' + parserErrors[0].textContent);
                            }
                            
                            // Validações específicas para NFe
                            if (xmlContent.includes('infNFe')) {
                                const infNFe = xmlDoc.getElementsByTagName('infNFe')[0];
                                if (!infNFe) {
                                    errors.push('Elemento infNFe não encontrado');
                                }
                                
                                // Valida estrutura básica
                                const requiredElements = ['ide', 'emit', 'dest', 'det', 'total'];
                                requiredElements.forEach(element => {
                                    if (!xmlDoc.getElementsByTagName(element)[0]) {
                                        errors.push(`Elemento obrigatório '${element}' não encontrado`);
                                    }
                                });
                                
                                // Simula validação na SEFAZ
                                if (Math.random() > 0.3) { // 70% de chance de sucesso
                                    warnings.push('XML validado com sucesso na SEFAZ-RS');
                                } else {
                                    errors.push('Erro de validação na SEFAZ-RS: Schema inválido');
                                }
                            }
                            
                            resolve({
                                valid: errors.length === 0,
                                errors: errors,
                                warnings: warnings,
                                elementCount: xmlDoc.getElementsByTagName('*').length
                            });
                        } catch (error) {
                            resolve({
                                valid: false,
                                errors: ['Erro ao processar XML: ' + error.message],
                                warnings: []
                            });
                        }
                    }, 1000);
                });
            }
            
            formatXML(xmlContent) {
                try {
                    const parser = new DOMParser();
                    const xmlDoc = parser.parseFromString(xmlContent, 'text/xml');
                    
                    const serializer = new XMLSerializer();
                    let formatted = serializer.serializeToString(xmlDoc);
                    
                    // Formatação simples
                    formatted = formatted.replace(/></g, '>\n<');
                    
                    return formatted;
                } catch (error) {
                    return xmlContent; // Retorna original se não conseguir formatar
                }
            }
        }
        
        class FileManager {
            constructor() {
                this.maxFileSize = 10 * 1024 * 1024; // 10MB
                this.allowedTypes = ['.pdf', '.doc', '.docx', '.xls', '.xlsx', '.txt', '.xml', '.json', '.sql'];
            }
            
            async saveFile(file) {
                return new Promise((resolve, reject) => {
                    if (file.size > this.maxFileSize) {
                        reject(new Error('Arquivo muito grande. Máximo 10MB.'));
                        return;
                    }
                    
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const fileData = {
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            data: e.target.result,
                            uploadedAt: new Date()
                        };
                        resolve(fileData);
                    };
                    reader.onerror = () => reject(new Error('Erro ao ler arquivo'));
                    reader.readAsDataURL(file);
                });
            }
            
            downloadFile(fileData, filename) {
                const link = document.createElement('a');
                link.href = fileData.data || fileData.url;
                link.download = filename || fileData.name;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            async compressFile(file) {
                // Simulação de compressão para arquivos de texto
                if (file.type.startsWith('text/')) {
                    return new Promise((resolve) => {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            const content = e.target.result;
                            // Simula compressão removendo espaços extras
                            const compressed = content.replace(/\s+/g, ' ').trim();
                            resolve({
                                ...file,
                                data: compressed,
                                originalSize: content.length,
                                compressedSize: compressed.length,
                                compressionRatio: (1 - compressed.length / content.length) * 100
                            });
                        };
                        reader.readAsText(file);
                    });
                }
                return file;
            }
        }
        
        // Inicialização dos gerenciadores
        const dbManager = new DatabaseManager();
        const xmlValidator = new XMLValidator();
        const fileManager = new FileManager();
        
        // =============================
        // VARIÁVEIS GLOBAIS E CONSTANTES
        // =============================
        
        const passwords = {
            'dynamic-password': '',
            'pdv-password': 'AdmPwd20',
            'default-password': 'AdmPwd6333',
            'sql-password': 'PoliSystemsapwd',
            'sql-domain-password': 'PoliSystemsapwd123'
        };
        
        let currentQueryResults = null;
        let connectionStatus = 'disconnected';
        
        // =============================
        // INICIALIZAÇÃO
        // =============================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeSystem();
        });
        
        async function initializeSystem() {
            showLoading('Inicializando sistema...');
            
            try {
                await Promise.all([
                    loadIP(),
                    loadLocalIP(),
                    loadSystemInfo(),
                    generateDynamicPassword(),
                    loadSavedData(),
                    loadDefaultSites(),
                    dbManager.initIndexedDB()
                ]);
                
                updateConnectionStatus('disconnected');
                hideLoading();
                showToast('Sistema inicializado com sucesso!', 'success');
            } catch (error) {
                hideLoading();
                showToast('Erro ao inicializar sistema: ' + error.message, 'error');
            }
        }
        
        // =============================
        // INFORMAÇÕES DO SISTEMA
        // =============================
        
        async function loadIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                document.getElementById('ip-address').textContent = data.ip;
            } catch (error) {
                document.getElementById('ip-address').textContent = 'Não foi possível obter o IP';
            }
        }
        
        function loadLocalIP() {
            const pc = new RTCPeerConnection({iceServers: []});
            pc.createDataChannel("");
            
            pc.onicecandidate = (ice) => {
                if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                const myIP = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/.exec(ice.candidate.candidate);
                if (myIP && myIP[1]) {
                    document.getElementById('local-ip').textContent = myIP[1];
                    pc.onicecandidate = () => {};
                }
            };
            
            pc.createOffer().then(pc.setLocalDescription.bind(pc));
        }
        
        async function loadSystemInfo() {
            // Navegador
            const ua = navigator.userAgent;
            let browser = 'Desconhecido';
            if (ua.includes('Chrome')) browser = 'Google Chrome';
            else if (ua.includes('Firefox')) browser = 'Mozilla Firefox';
            else if (ua.includes('Safari') && !ua.includes('Chrome')) browser = 'Safari';
            else if (ua.includes('Edge')) browser = 'Microsoft Edge';
            document.getElementById('browser-info').textContent = browser;
            
            // Sistema Operacional
            let os = 'Desconhecido';
            if (ua.includes('Windows NT 10.0')) os = 'Windows 10/11';
            else if (ua.includes('Windows NT 6.3')) os = 'Windows 8.1';
            else if (ua.includes('Windows NT 6.1')) os = 'Windows 7';
            else if (ua.includes('Windows')) os = 'Windows';
            else if (ua.includes('Mac OS X')) {
                const version = ua.match(/Mac OS X ([0-9_]+)/);
                os = version ? `macOS ${version[1].replace(/_/g, '.')}` : 'macOS';
            }
            else if (ua.includes('Linux')) os = 'Linux';
            else if (ua.includes('Android')) {
                const version = ua.match(/Android ([0-9.]+)/);
                os = version ? `Android ${version[1]}` : 'Android';
            }
            else if (ua.includes('iOS')) os = 'iOS';
            document.getElementById('os-info').textContent = os;
            
            // Nome do computador (limitado no browser)
            document.getElementById('computer-name').textContent = navigator.platform || 'Não disponível';
            
            // Resolução
            document.getElementById('resolution-info').textContent = `${screen.width}x${screen.height} (${screen.availWidth}x${screen.availHeight} utilizável)`;
            
            // Timezone
            document.getElementById('timezone-info').textContent = Intl.DateTimeFormat().resolvedOptions().timeZone;
            
            // Idioma
            document.getElementById('language-info').textContent = `${navigator.language} (${navigator.languages.join(', ')})`;
            
            // Memória (se disponível)
            if ('deviceMemory' in navigator) {
                document.getElementById('memory-info').textContent = `${navigator.deviceMemory} GB`;
            } else {
                document.getElementById('memory-info').textContent = 'Não disponível';
            }
            
            // CPU (se disponível)
            if ('hardwareConcurrency' in navigator) {
                document.getElementById('cpu-info').textContent = `${navigator.hardwareConcurrency} cores lógicos`;
            } else {
                document.getElementById('cpu-info').textContent = 'Não disponível';
            }
            
            // Conexão
            if ('connection' in navigator) {
                const conn = navigator.connection;
                const speed = conn.downlink ? `${conn.downlink} Mbps` : 'Desconhecida';
                const type = conn.effectiveType || conn.type || 'Desconhecido';
                document.getElementById('connection-info').textContent = `${type} - ${speed}`;
            } else {
                document.getElementById('connection-info').textContent = 'Informação não disponível';
            }
            
            // User Agent
            document.getElementById('useragent-info').textContent = ua;
        }
        
        function generateDynamicPassword() {
            const now = new Date();
            const day = now.getDate();
            const month = now.getMonth() + 1;
            const year = now.getFullYear();
            const yearSuffix = parseInt(year.toString().slice(-2));
            
            const sum = day + month + yearSuffix;
            const password = `AdmPwd20${sum}`;
            
            passwords['dynamic-password'] = password;
        }
        
        // =============================
        // GERENCIAMENTO DE SENHAS
        // =============================
        
        function togglePasswordVisibility(passwordId) {
            const passwordElement = document.getElementById(passwordId);
            const eyeElement = document.getElementById(passwordId + '-eye');
            
            if (passwordElement.classList.contains('password-hidden')) {
                passwordElement.textContent = passwords[passwordId];
                passwordElement.classList.remove('password-hidden');
                eyeElement.classList.remove('fa-eye');
                eyeElement.classList.add('fa-eye-slash');
            } else {
                const length = passwords[passwordId].length;
                passwordElement.textContent = '•'.repeat(length);
                passwordElement.classList.add('password-hidden');
                eyeElement.classList.remove('fa-eye-slash');
                eyeElement.classList.add('fa-eye');
            }
        }
        
        function copyPassword(passwordId) {
            const password = passwords[passwordId];
            copyToClipboard(null, password);
        }
        
        // =============================
        // GERENCIAMENTO DE BANCO DE DADOS
        // =============================
        
        async function connectDatabase() {
            const connectionData = {
                type: document.getElementById('db-type').value,
                host: document.getElementById('db-host').value,
                port: document.getElementById('db-port').value,
                database: document.getElementById('db-name').value,
                user: document.getElementById('db-user').value,
                password: document.getElementById('db-password').value
            };
            
            const saveConnection = document.getElementById('save-connection').checked;
            const btnText = document.querySelector('.connection-btn-text');
            
            try {
                btnText.innerHTML = '<span class="spinner"></span>Conectando...';
                updateConnectionStatus('connecting');
                
                const result = await dbManager.connect(connectionData);
                
                if (saveConnection) {
                    await dbManager.saveConnection(connectionData);
                }
                
                updateConnectionStatus('connected');
                showToast('Conectado ao banco de dados com sucesso!', 'success');
                closeModal('db-modal');
                clearConnectionForm();
                
            } catch (error) {
                updateConnectionStatus('disconnected');
                showToast('Erro ao conectar: ' + error.message, 'error');
            } finally {
                btnText.textContent = 'Conectar';
            }
        }
        
        async function testConnection() {
            const connectionData = {
                type: document.getElementById('db-type').value,
                host: document.getElementById('db-host').value,
                port: document.getElementById('db-port').value,
                database: document.getElementById('db-name').value,
                user: document.getElementById('db-user').value,
                password: document.getElementById('db-password').value
            };
            
            const resultDiv = document.getElementById('connection-test-result');
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<div class="spinner"></div>Testando conexão...';
            
            try {
                await dbManager.connect(connectionData);
                resultDiv.innerHTML = `
                    <div class="bg-green-50 border border-green-200 p-3 rounded">
                        <i class="fas fa-check-circle text-green-600 mr-2"></i>
                        <span class="text-green-800">Conexão testada com sucesso!</span>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 p-3 rounded">
                        <i class="fas fa-exclamation-circle text-red-600 mr-2"></i>
                        <span class="text-red-800">Erro: ${error.message}</span>
                    </div>
                `;
            }
        }
        
        async function executeQuery() {
            const query = document.getElementById('execute-query').value.trim();
            if (!query) {
                showToast('Digite uma consulta SQL', 'warning');
                return;
            }
            
            const executeBtn = document.getElementById('execute-btn');
            const resultsDiv = document.getElementById('query-results');
            const statsSpan = document.getElementById('query-stats');
            
            try {
                executeBtn.innerHTML = '<span class="spinner"></span>Executando...';
                executeBtn.disabled = true;
                
                const startTime = Date.now();
                const result = await dbManager.executeQuery(query);
                const endTime = Date.now();
                
                displayQueryResults(result.results);
                currentQueryResults = result.results;
                
                statsSpan.textContent = `Executado em ${result.executionTime}ms - ${result.rowsAffected} linha(s) afetada(s)`;
                document.getElementById('export-btn').style.display = 'inline-block';
                
                showToast('Consulta executada com sucesso!', 'success');
                
            } catch (error) {
                resultsDiv.innerHTML = `
                    <div class="p-4 bg-red-50 border border-red-200 rounded">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                            <strong class="text-red-800">Erro na Execução</strong>
                        </div>
                        <p class="text-red-700">${error.message}</p>
                    </div>
                `;
                showToast('Erro ao executar consulta: ' + error.message, 'error');
            } finally {
                executeBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Executar';
                executeBtn.disabled = false;
            }
        }
        
        function displayQueryResults(results) {
            const resultsDiv = document.getElementById('query-results');
            
            if (!results || results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="p-4 text-gray-500">
                        <i class="fas fa-info-circle mr-2"></i>Nenhum resultado encontrado.
                    </div>
                `;
                return;
            }
            
            // Se é um resultado de operação (INSERT, UPDATE, DELETE)
            if (results[0] && results[0].message) {
                resultsDiv.innerHTML = `
                    <div class="p-4 bg-green-50 border border-green-200 rounded">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            <span class="text-green-800">${results[0].message}</span>
                            ${results[0].rowsAffected ? `<span class="ml-2 text-green-600">(${results[0].rowsAffected} linha(s))</span>` : ''}
                        </div>
                    </div>
                `;
                return;
            }
            
            // Se é um resultado de SELECT, cria tabela
            const headers = Object.keys(results[0]);
            let tableHTML = `
                <div class="query-result-table">
                    <table class="w-full border-collapse border border-gray-300">
                        <thead>
                            <tr class="bg-gray-100">
                                ${headers.map(header => `<th class="border border-gray-300 px-4 py-2 text-left font-semibold">${header}</th>`).join('')}
                            </tr>
                        </thead>
                        <tbody>
                            ${results.map(row => `
                                <tr class="hover:bg-gray-50">
                                    ${headers.map(header => `<td class="border border-gray-300 px-4 py-2">${row[header] || ''}</td>`).join('')}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-sm">
                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                    <span class="text-blue-800">${results.length} registro(s) encontrado(s)</span>
                </div>
            `;
            
            resultsDiv.innerHTML = tableHTML;
        }
        
        function exportResults() {
            if (!currentQueryResults || currentQueryResults.length === 0) {
                showToast('Nenhum resultado para exportar', 'warning');
                return;
            }
            
            const headers = Object.keys(currentQueryResults[0]);
            let csvContent = headers.join(',') + '\n';
            
            currentQueryResults.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header] || '';
                    return `"${value.toString().replace(/"/g, '""')}"`;
                });
                csvContent += values.join(',') + '\n';
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `query_results_${new Date().toISOString().slice(0, 19)}.csv`;
            link.click();
            
            showToast('Resultados exportados com sucesso!', 'success');
        }
        
        function formatQuerySQL() {
            const textarea = document.getElementById('execute-query');
            let query = textarea.value;
            
            // Formatação básica de SQL
            query = query
                .replace(/\s+/g, ' ')
                .replace(/\s*,\s*/g, ',\n    ')
                .replace(/\s*(SELECT|FROM|WHERE|ORDER BY|GROUP BY|HAVING|INSERT|UPDATE|DELETE|INTO|VALUES)\s+/gi, '\n$1 ')
                .replace(/\s*(AND|OR)\s+/gi, '\n    $1 ')
                .replace(/\s*;\s*/g, ';\n')
                .trim();
            
            textarea.value = query;
            showToast('Query formatada!', 'success');
        }
        
        function clearQuery() {
            document.getElementById('execute-query').value = '';
            document.getElementById('query-results').innerHTML = `
                <div class="p-4 text-gray-500">
                    <i class="fas fa-database mr-2"></i>Os resultados da consulta aparecerão aqui...
                </div>
            `;
            document.getElementById('query-stats').textContent = '';
            document.getElementById('export-btn').style.display = 'none';
            currentQueryResults = null;
        }
        
        function updateConnectionStatus(status) {
            connectionStatus = status;
            const indicator = document.getElementById('connection-indicator');
            const text = document.getElementById('connection-status-text');
            const executorIndicator = document.getElementById('executor-connection-indicator');
            const executorText = document.getElementById('executor-connection-text');
            
            const configs = {
                connected: {
                    class: 'status-connected',
                    text: 'Conectado ao BD'
                },
                connecting: {
                    class: 'status-connecting',
                    text: 'Conectando...'
                },
                disconnected: {
                    class: 'status-disconnected',
                    text: 'Desconectado'
                }
            };
            
            const config = configs[status];
            
            [indicator, executorIndicator].forEach(el => {
                if (el) {
                    el.className = 'connection-status ' + config.class;
                }
            });
            
            [text, executorText].forEach(el => {
                if (el) {
                    el.textContent = config.text;
                }
            });
        }
        
        function reconnectDatabase() {
            updateConnectionStatus('connecting');
            setTimeout(() => {
                if (dbManager.currentConnection) {
                    updateConnectionStatus('connected');
                    showToast('Reconectado com sucesso!', 'success');
                } else {
                    updateConnectionStatus('disconnected');
                    showToast('Falha na reconexão. Verifique as configurações.', 'error');
                }
            }, 2000);
        }
        
        function clearConnectionForm() {
            ['db-host', 'db-port', 'db-name', 'db-user', 'db-password'].forEach(id => {
                document.getElementById(id).value = '';
            });
            document.getElementById('save-connection').checked = false;
        }
        
        // =============================
        // VALIDAÇÃO XML
        // =============================
        
        async function validateXML() {
            const xmlContent = document.getElementById('xml-content').value.trim();
            const resultDiv = document.getElementById('xml-result');
            
            if (!xmlContent) {
                showToast('Por favor, insira o conteúdo do XML', 'warning');
                return;
            }
            
            resultDiv.classList.remove('hidden');
            resultDiv.innerHTML = '<div class="spinner"></div>Validando XML...';
            
            try {
                const validation = await xmlValidator.validateXML(xmlContent);
                
                let resultHTML = '';
                
                if (validation.valid) {
                    resultHTML = `
                        <div class="bg-green-50 border border-green-200 p-4 rounded">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <strong class="text-green-800">XML Válido</strong>
                            </div>
                            <p class="text-green-700">O XML foi validado com sucesso!</p>
                            <p class="text-sm text-green-600 mt-2">Elementos encontrados: ${validation.elementCount}</p>
                        </div>
                    `;
                } else {
                    resultHTML = `
                        <div class="bg-red-50 border border-red-200 p-4 rounded">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                                <strong class="text-red-800">XML Inválido</strong>
                            </div>
                            <div class="text-red-700">
                                <p class="font-semibold">Erros encontrados:</p>
                                <ul class="list-disc list-inside mt-2">
                                    ${validation.errors.map(error => `<li>${error}</li>`).join('')}
                                </ul>
                            </div>
                        </div>
                    `;
                }
                
                if (validation.warnings.length > 0) {
                    resultHTML += `
                        <div class="bg-yellow-50 border border-yellow-200 p-4 rounded mt-2">
                            <div class="flex items-center mb-2">
                                <i class="fas fa-exclamation-circle text-yellow-600 mr-2"></i>
                                <strong class="text-yellow-800">Avisos</strong>
                            </div>
                            <ul class="list-disc list-inside text-yellow-700">
                                ${validation.warnings.map(warning => `<li>${warning}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                }
                
                resultDiv.innerHTML = resultHTML;
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="bg-red-50 border border-red-200 p-4 rounded">
                        <div class="flex items-center mb-2">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                            <strong class="text-red-800">Erro na Validação</strong>
                        </div>
                        <p class="text-red-700">${error.message}</p>
                    </div>
                `;
            }
        }
        
        function formatXML() {
            const textarea = document.getElementById('xml-content');
            const xmlContent = textarea.value.trim();
            
            if (!xmlContent) {
                showToast('Por favor, insira o conteúdo do XML', 'warning');
                return;
            }
            
            const formatted = xmlValidator.formatXML(xmlContent);
            textarea.value = formatted;
            showToast('XML formatado!', 'success');
        }
        
        // =============================
        // GERENCIAMENTO DE ANOTAÇÕES
        // =============================
        
        async function saveNote() {
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('notes-area').value.trim();
            
            if (!title || !content) {
                showToast('Preencha o título e o conteúdo da anotação', 'warning');
                return;
            }
            
            try {
                const transaction = dbManager.db.transaction(['notes'], 'readwrite');
                const store = transaction.objectStore('notes');
                
                const note = {
                    title: title,
                    content: content,
                    createdAt: new Date(),
                    updatedAt: new Date()
                };
                
                await new Promise((resolve, reject) => {
                    const request = store.add(note);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                document.getElementById('note-title').value = '';
                document.getElementById('notes-area').value = '';
                
                loadNotes();
                showToast('Anotação salva com sucesso!', 'success');
                
            } catch (error) {
                showToast('Erro ao salvar anotação: ' + error.message, 'error');
            }
        }
        
        async function loadNotes() {
            try {
                const transaction = dbManager.db.transaction(['notes'], 'readonly');
                const store = transaction.objectStore('notes');
                
                const notes = await new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                const notesList = document.getElementById('notes-list');
                notesList.innerHTML = '';
                
                notes.forEach(note => {
                    const noteElement = document.createElement('div');
                    noteElement.className = 'bg-gray-50 p-4 rounded border';
                    noteElement.innerHTML = `
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-semibold text-gray-800">${note.title}</h4>
                            <div class="flex gap-2">
                                <button onclick="editNote(${note.id})" class="text-blue-600 hover:text-blue-800">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button onclick="deleteNote(${note.id})" class="text-red-600 hover:text-red-800">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <p class="text-gray-700 text-sm whitespace-pre-wrap">${note.content}</p>
                        <div class="text-xs text-gray-500 mt-2">
                            Criado em: ${new Date(note.createdAt).toLocaleString()}
                        </div>
                    `;
                    notesList.appendChild(noteElement);
                });
                
            } catch (error) {
                console.error('Erro ao carregar anotações:', error);
            }
        }
        
        async function deleteNote(noteId) {
            if (!confirm('Tem certeza que deseja excluir esta anotação?')) return;
            
            try {
                const transaction = dbManager.db.transaction(['notes'], 'readwrite');
                const store = transaction.objectStore('notes');
                
                await new Promise((resolve, reject) => {
                    const request = store.delete(noteId);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                loadNotes();
                showToast('Anotação excluída!', 'success');
                
            } catch (error) {
                showToast('Erro ao excluir anotação: ' + error.message, 'error');
            }
        }
        
        // =============================
        // GERENCIAMENTO DE DOWNLOADS
        // =============================
        
        async function addDownload() {
            const name = document.getElementById('download-name').value.trim();
            const url = document.getElementById('download-url').value.trim();
            const files = document.getElementById('upload-file').files;
            
            if (!name || (!url && files.length === 0)) {
                showToast('Preencha o nome e adicione um URL ou arquivo', 'warning');
                return;
            }
            
            try {
                if (files.length > 0) {
                    // Processar múltiplos arquivos
                    for (let file of files) {
                        const fileData = await fileManager.saveFile(file);
                        await saveDownloadToDB({
                            name: name || file.name,
                            type: 'file',
                            ...fileData
                        });
                    }
                } else {
                    // Salvar URL
                    await saveDownloadToDB({
                        name: name,
                        type: 'url',
                        url: url,
                        createdAt: new Date()
                    });
                }
                
                // Limpar formulário
                document.getElementById('download-name').value = '';
                document.getElementById('download-url').value = '';
                document.getElementById('upload-file').value = '';
                
                loadDownloads();
                showToast('Download adicionado com sucesso!', 'success');
                
            } catch (error) {
                showToast('Erro ao adicionar download: ' + error.message, 'error');
            }
        }
        
        async function saveDownloadToDB(downloadData) {
            const transaction = dbManager.db.transaction(['downloads'], 'readwrite');
            const store = transaction.objectStore('downloads');
            
            return new Promise((resolve, reject) => {
                const request = store.add(downloadData);
                request.onsuccess = () => resolve(request.result);
                request.onerror = () => reject(request.error);
            });
        }
        
        async function loadDownloads() {
            try {
                const transaction = dbManager.db.transaction(['downloads'], 'readonly');
                const store = transaction.objectStore('downloads');
                
                const downloads = await new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                const downloadsList = document.getElementById('downloads-list');
                downloadsList.innerHTML = '';
                
                downloads.forEach(download => {
                    const downloadElement = document.createElement('div');
                    downloadElement.className = 'bg-gray-50 p-3 rounded border flex justify-between items-center';
                    
                    const sizeText = download.size ? ` (${formatFileSize(download.size)})` : '';
                    const typeText = download.type === 'url' ? 'Link externo' : `Arquivo: ${download.originalSize ? formatFileSize(download.originalSize) : 'tamanho desconhecido'}`;
                    
                    downloadElement.innerHTML = `
                        <div>
                            <strong>${download.name}</strong>${sizeText}
                            <span class="text-sm text-gray-600 block">${typeText}</span>
                            ${download.uploadedAt ? `<span class="text-xs text-gray-500">Adicionado: ${new Date(download.uploadedAt).toLocaleString()}</span>` : ''}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="downloadFile(${download.id})" class="text-blue-600 hover:text-blue-800" title="Download">
                                <i class="fas fa-download"></i>
                            </button>
                            <button onclick="shareDownload(${download.id})" class="text-green-600 hover:text-green-800" title="Compartilhar">
                                <i class="fas fa-share"></i>
                            </button>
                            <button onclick="removeDownload(${download.id})" class="text-red-600 hover:text-red-800" title="Remover">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    downloadsList.appendChild(downloadElement);
                });
                
            } catch (error) {
                console.error('Erro ao carregar downloads:', error);
            }
        }
        
        async function downloadFile(downloadId) {
            try {
                const transaction = dbManager.db.transaction(['downloads'], 'readonly');
                const store = transaction.objectStore('downloads');
                
                const download = await new Promise((resolve, reject) => {
                    const request = store.get(downloadId);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
                
                if (download.type === 'url') {
                    window.open(download.url, '_blank');
                } else {
                    fileManager.downloadFile(download, download.name);
                }
                
                showToast('Download iniciado!', 'success');
                
            } catch (error) {
                showToast('Erro ao fazer download: ' + error.message, 'error');
            }
        }
        
        async function removeDownload(downloadId) {
            if (!confirm('Tem certeza que deseja remover este download?')) return;
            
            try {
                const transaction = dbManager.db.transaction(['downloads'], 'readwrite');
                const store = transaction.objectStore('downloads');
                
                await new Promise((resolve, reject) => {
                    const request = store.delete(downloadId);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                loadDownloads();
                showToast('Download removido!', 'success');
                
            } catch (error) {
                showToast('Erro ao remover download: ' + error.message, 'error');
            }
        }
        
        async function clearAllDownloads() {
            if (!confirm('Tem certeza que deseja remover todos os downloads?')) return;
            
            try {
                const transaction = dbManager.db.transaction(['downloads'], 'readwrite');
                const store = transaction.objectStore('downloads');
                
                await new Promise((resolve, reject) => {
                    const request = store.clear();
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                
                loadDownloads();
                showToast('Todos os downloads foram removidos!', 'success');
                
            } catch (error) {
                showToast('Erro ao limpar downloads: ' + error.message, 'error');
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // =============================
        // FUNÇÕES UTILITÁRIAS
        // =============================
        
        function copyToClipboard(elementId, text = null) {
            const textToCopy = text || document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(textToCopy).then(() => {
                showToast('Copiado para a área de transferência!', 'success');
            }).catch(() => {
                showToast('Erro ao copiar para a área de transferência', 'error');
            });
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-4 py-2 rounded shadow-lg z-50 transform transition-transform duration-300`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            // Animação de entrada
            setTimeout(() => toast.style.transform = 'translateX(0)', 10);
            
            // Remoção automática
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        function showLoading(message = 'Carregando...') {
            const loading = document.createElement('div');
            loading.id = 'loading-overlay';
            loading.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            loading.innerHTML = `
                <div class="bg-white p-6 rounded-lg flex items-center">
                    <div class="spinner mr-3"></div>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(loading);
        }
        
        function hideLoading() {
            const loading = document.getElementById('loading-overlay');
            if (loading) loading.remove();
        }
        
        // =============================
        // FUNÇÕES EXISTENTES (ADAPTADAS)
        // =============================
        
        function openTab(evt, tabName) {
            const tabcontents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabcontents.length; i++) {
                tabcontents[i].classList.remove('active');
            }
            
            const tablinks = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove('border-blue-600', 'text-blue-600');
                tablinks[i].classList.add('border-transparent', 'text-gray-600');
            }
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.remove('border-transparent', 'text-gray-600');
            evt.currentTarget.classList.add('border-blue-600', 'text-blue-600');
        }
        
        function addMenu() {
            const name = document.getElementById('menu-name').value.trim();
            const text = document.getElementById('menu-text').value.trim();
            
            if (name && text) {
                const menuList = document.getElementById('menu-list');
                const menuItem = document.createElement('div');
                menuItem.className = 'bg-gray-50 p-3 rounded border flex justify-between items-center';
                menuItem.innerHTML = `
                    <div>
                        <strong>${name}:</strong> ${text}
                    </div>
                    <button onclick="removeMenu(this)" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                
                menuList.appendChild(menuItem);
                
                document.getElementById('menu-name').value = '';
                document.getElementById('menu-text').value = '';
                
                saveMenus();
                showToast('Menu adicionado!', 'success');
            }
        }
        
        function removeMenu(button) {
            button.parentElement.remove();
            saveMenus();
            showToast('Menu removido!', 'success');
        }
        
        function saveQuery() {
            const name = document.getElementById('query-name').value.trim();
            const query = document.getElementById('sql-query').value.trim();
            
            if (name && query) {
                let savedQueries = JSON.parse(localStorage.getItem('savedQueries') || '[]');
                savedQueries.push({ name, query, createdAt: new Date() });
                localStorage.setItem('savedQueries', JSON.stringify(savedQueries));
                
                document.getElementById('query-name').value = '';
                document.getElementById('sql-query').value = '';
                
                loadSavedQueries();
                showToast('Consulta salva!', 'success');
            }
        }
        
        function loadSavedData() {
            loadMenus();
            loadSavedQueries();
            loadDownloads();
            loadSites();
            loadNotes();
        }
        
        function loadMenus() {
            const menus = JSON.parse(localStorage.getItem('menus') || '[]');
            const menuList = document.getElementById('menu-list');
            menuList.innerHTML = '';
            
            menus.forEach(menu => {
                const menuItem = document.createElement('div');
                menuItem.className = 'bg-gray-50 p-3 rounded border flex justify-between items-center';
                menuItem.innerHTML = `
                    <div>
                        <strong>${menu.name}:</strong> ${menu.text}
                    </div>
                    <button onclick="removeMenu(this)" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                `;
                menuList.appendChild(menuItem);
            });
        }
        
        function saveMenus() {
            const menuItems = document.querySelectorAll('#menu-list > div');
            const menus = [];
            
            menuItems.forEach(item => {
                const text = item.querySelector('div').innerHTML;
                const match = text.match(/<strong>(.*?):<\/strong> (.*)/);
                if (match) {
                    menus.push({ name: match[1], text: match[2] });
                }
            });
            
            localStorage.setItem('menus', JSON.stringify(menus));
        }
        
        function loadSavedQueries() {
            const queries = JSON.parse(localStorage.getItem('savedQueries') || '[]');
            const queriesList = document.getElementById('saved-queries');
            const select = document.getElementById('saved-query-select');
            
            queriesList.innerHTML = '';
            select.innerHTML = '<option value="">Selecionar consulta salva...</option>';
            
            queries.forEach((query, index) => {
                const queryItem = document.createElement('div');
                queryItem.className = 'bg-gray-50 p-3 rounded border flex justify-between items-center';
                queryItem.innerHTML = `
                    <div>
                        <strong>${query.name}</strong>
                        <pre class="text-sm text-gray-600 mt-1 whitespace-pre-wrap">${query.query}</pre>
                        ${query.createdAt ? `<div class="text-xs text-gray-500 mt-1">Criado: ${new Date(query.createdAt).toLocaleString()}</div>` : ''}
                    </div>
                    <div class="flex gap-2">
                        <button onclick="loadQueryInExecutor(${index})" class="text-green-600 hover:text-green-800" title="Executar">
                            <i class="fas fa-play"></i>
                        </button>
                        <button onclick="removeSavedQuery(${index})" class="text-red-600 hover:text-red-800" title="Remover">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                queriesList.appendChild(queryItem);
                
                const option = document.createElement('option');
                option.value = index;
                option.textContent = query.name;
                select.appendChild(option);
            });
        }
        
        function loadQueryInExecutor(index) {
            const queries = JSON.parse(localStorage.getItem('savedQueries') || '[]');
            if (queries[index]) {
                document.getElementById('execute-query').value = queries[index].query;
                document.getElementById('query-executor-modal').classList.remove('hidden');
                showToast('Consulta carregada no executor!', 'success');
            }
        }
        
        function removeSavedQuery(index) {
            if (!confirm('Tem certeza que deseja remover esta consulta?')) return;
            
            let queries = JSON.parse(localStorage.getItem('savedQueries') || '[]');
            queries.splice(index, 1);
            localStorage.setItem('savedQueries', JSON.stringify(queries));
            loadSavedQueries();
            showToast('Consulta removida!', 'success');
        }
        
        function loadSavedQuery() {
            const select = document.getElementById('saved-query-select');
            const index = select.value;
            
            if (index !== '') {
                const queries = JSON.parse(localStorage.getItem('savedQueries') || '[]');
                if (queries[index]) {
                    document.getElementById('execute-query').value = queries[index].query;
                    showToast('Consulta carregada!', 'success');
                }
            }
        }
        
        function openBottomTab(tab) {
            switch(tab) {
                case 'tools':
                    showToast('Use as abas acima para acessar as ferramentas', 'info');
                    break;
                case 'database':
                    document.getElementById('db-modal').classList.remove('hidden');
                    break;
                case 'downloads':
                    document.getElementById('downloads-modal').classList.remove('hidden');
                    break;
                case 'sites':
                    document.getElementById('sites-modal').classList.remove('hidden');
                    break;
            }
        }
        
        function toggleQueryMenu() {
            const menu = document.getElementById('query-menu');
            const menuItems = menu.querySelectorAll('.menu-item');
            
            if (menu.style.display === 'none') {
                menu.style.display = 'block';
                setTimeout(() => {
                    menuItems.forEach((item, index) => {
                        setTimeout(() => {
                            item.classList.add('show');
                        }, index * 100);
                    });
                }, 50);
            } else {
                menuItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.remove('show');
                    }, index * 50);
                });
                setTimeout(() => {
                    menu.style.display = 'none';
                }, menuItems.length * 50 + 200);
            }
        }
        
        function openQueryExecutor(type) {
            document.getElementById('query-executor-modal').classList.remove('hidden');
            toggleQueryMenu();
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function loadDefaultSites() {
            let sites = JSON.parse(localStorage.getItem('sites') || '[]');
            
            const defaultSites = [
                { name: 'SEFAZ-RS', url: 'https://www.sefaz.rs.gov.br/', category: 'Fiscal' },
                { name: 'Receita Federal', url: 'https://www.gov.br/receitafederal/', category: 'Fiscal' },
                { name: 'Validador XML NFe', url: 'https://www.nfe.fazenda.gov.br/portal/consulta.aspx', category: 'Validação' },
                { name: 'Consulta CNPJ', url: 'https://www.gov.br/receitafederal/pt-br/assuntos/orientacao-tributaria/cadastros/consultas/consulta-publica-cnpj', category: 'Consulta' },
                { name: 'Portal NFe', url: 'http://www.nfe.fazenda.gov.br/', category: 'NFe' },
                { name: 'SINTEGRA', url: 'http://www.sintegra.gov.br/', category: 'Consulta' }
            ];
            
            if (sites.length === 0) {
                localStorage.setItem('sites', JSON.stringify(defaultSites));
            }
            
            loadSites();
        }
        
        function addSite() {
            const name = document.getElementById('site-name').value.trim();
            const url = document.getElementById('site-url').value.trim();
            
            if (name && url) {
                let sites = JSON.parse(localStorage.getItem('sites') || '[]');
                sites.push({ 
                    name, 
                    url, 
                    category: 'Personalizado',
                    addedAt: new Date()
                });
                localStorage.setItem('sites', JSON.stringify(sites));
                
                document.getElementById('site-name').value = '';
                document.getElementById('site-url').value = '';
                
                loadSites();
                showToast('Site adicionado!', 'success');
            }
        }
        
        function loadSites() {
            const sites = JSON.parse(localStorage.getItem('sites') || '[]');
            const sitesList = document.getElementById('sites-list');
            
            sitesList.innerHTML = '';
            
            // Agrupar por categoria
            const categories = [...new Set(sites.map(site => site.category || 'Geral'))];
            
            categories.forEach(category => {
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'font-semibold text-gray-700 mt-3 mb-2 text-sm border-b pb-1';
                categoryHeader.textContent = category;
                sitesList.appendChild(categoryHeader);
                
                sites.filter(site => (site.category || 'Geral') === category).forEach((site, index) => {
                    const siteItem = document.createElement('div');
                    siteItem.className = 'bg-gray-50 p-3 rounded border flex justify-between items-center mb-1';
                    siteItem.innerHTML = `
                        <div>
                            <strong>${site.name}</strong>
                            <span class="text-sm text-gray-600 block truncate" style="max-width: 200px;" title="${site.url}">${site.url}</span>
                        </div>
                        <div class="flex gap-2">
                            <button onclick="openSite('${site.url}')" class="text-blue-600 hover:text-blue-800" title="Abrir site">
                                <i class="fas fa-external-link-alt"></i>
                            </button>
                            <button onclick="copyToClipboard(null, '${site.url}')" class="text-green-600 hover:text-green-800" title="Copiar URL">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button onclick="removeSite(${sites.indexOf(site)})" class="text-red-600 hover:text-red-800" title="Remover site">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    sitesList.appendChild(siteItem);
                });
            });
        }
        
        function openSite(url) {
            window.open(url, '_blank');
        }
        
        function removeSite(index) {
            if (!confirm('Tem certeza que deseja remover este site?')) return;
            
            let sites = JSON.parse(localStorage.getItem('sites') || '[]');
            sites.splice(index, 1);
            localStorage.setItem('sites', JSON.stringify(sites));
            loadSites();
            showToast('Site removido!', 'success');
        }
        
        function exportSites() {
            const sites = JSON.parse(localStorage.getItem('sites') || '[]');
            const dataStr = JSON.stringify(sites, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `sites_uteis_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            showToast('Sites exportados!', 'success');
        }
        
        function importSites() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        try {
                            const importedSites = JSON.parse(e.target.result);
                            let sites = JSON.parse(localStorage.getItem('sites') || '[]');
                            sites = sites.concat(importedSites);
                            localStorage.setItem('sites', JSON.stringify(sites));
                            loadSites();
                            showToast(`${importedSites.length} sites importados!`, 'success');
                        } catch (error) {
                            showToast('Erro ao importar sites: arquivo inválido', 'error');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }
    </script>

</body></html>