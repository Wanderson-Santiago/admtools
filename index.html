<!DOCTYPE html><html lang="pt-BR"><head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Gerenciador de Sistemas</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb"/>
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
    <meta name="apple-mobile-web-app-title" content="Gerenciador"/>
    <link rel="apple-touch-icon" href="data:image/svg+xml,&lt;svg xmlns=&#39;http://www.w3.org/2000/svg&#39; viewBox=&#39;0 0 100 100&#39;&gt;&lt;text y=&#39;.9em&#39; font-size=&#39;90&#39;&gt;⚙️&lt;/text&gt;&lt;/svg&gt;"/>
    
    <!-- Meta Tags para SEO -->
    <meta name="description" content="Sistema completo de gerenciamento com autenticação e ferramentas avançadas"/>
    <meta property="og:title" content="Gerenciador de Sistemas"/>
    <meta property="og:description" content="Sistema completo de gerenciamento com autenticação e ferramentas avançadas"/>
    <meta property="og:url" content="https://www.onspace.ai"/>
    <meta property="og:type" content="website"/>
    <meta property="og:site_name" content="OnSpace.AI"/>
    <meta property="og:image" content="https://cdn-ai.onspace.ai/onspace/project/screenshot/online/pre-site/9b1ie1.jpg"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Gerenciador de Sistemas"/>
    <meta name="twitter:description" content="Sistema completo de gerenciamento com autenticação e ferramentas avançadas"/>
    
    <style>
        /* Estilos personalizados para melhor responsividade */
        .mobile-optimized {
            touch-action: manipulation;
            -webkit-tap-highlight-color: transparent;
        }
        
        .password-hidden {
            font-family: 'Courier New', monospace;
            letter-spacing: 2px;
        }
        
        .floating-menu {
            position: fixed;
            bottom: 80px;
            right: 20px;
            z-index: 1000;
        }
        
        .menu-item {
            margin-bottom: 10px;
            transform: scale(0);
            transition: transform 0.3s ease;
        }
        
        .menu-item.show {
            transform: scale(1);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .connection-status {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .status-connected { background-color: #10b981; }
        .status-disconnected { background-color: #ef4444; }
        .status-connecting { background-color: #f59e0b; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .spinner {
            border: 2px solid #f3f3f3;
            border-top: 2px solid #3498db;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 8px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Melhorias de responsividade */
        @media (max-width: 768px) {
            .grid-responsive {
                grid-template-columns: 1fr;
            }
            
            .text-responsive {
                font-size: 0.875rem;
            }
            
            .p-responsive {
                padding: 0.75rem;
            }
        }
        
        /* Animações suaves */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Estilos para PWA */
        .install-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            transform: translateY(100%);
            transition: transform 0.3s ease;
            z-index: 1001;
        }
        
        .install-banner.show {
            transform: translateY(0);
        }
        
        /* Overlay de loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            backdrop-filter: blur(4px);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* Estilos para Admin Only */
        .admin-only {
            display: none;
        }
        
        .admin-only.show {
            display: block;
        }
        
        /* Estilos para Tasks Drag and Drop */
        .task-card {
            cursor: move;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .task-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .task-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        .drop-zone {
            min-height: 100px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }
        
        .drop-zone.drag-over {
            background-color: rgba(59, 130, 246, 0.1);
            border: 2px dashed #3b82f6;
        }
        
        /* Status Colors */
        .status-todo { border-left: 4px solid #f59e0b; }
        .status-progress { border-left: 4px solid #3b82f6; }
        .status-done { border-left: 4px solid #10b981; }
        
        /* Attachment Preview */
        .attachment-preview {
            max-width: 60px;
            max-height: 60px;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .attachment-preview:hover {
            transform: scale(1.1);
            transition: transform 0.2s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen mobile-optimized">
    <!-- Tela de Login -->
    <div id="login-screen" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-blue-500 to-purple-600">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-cogs text-2xl text-blue-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Gerenciador de Sistemas</h1>
                <p class="text-gray-600 mt-2">Faça login para acessar o sistema</p>
            </div>
            
            <form id="login-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usuário</label>
                    <input type="text" id="username" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="Digite seu usuário"/>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="password" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent pr-12" placeholder="Digite sua senha"/>
                        <button type="button" onclick="toggleLoginPasswordVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye" id="login-password-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <label class="flex items-center">
                        <input type="checkbox" id="remember-me" class="rounded border-gray-300 text-blue-600 focus:ring-blue-500"/>
                        <span class="ml-2 text-sm text-gray-600">Lembrar-me</span>
                    </label>
                    <a href="#" class="text-sm text-blue-600 hover:text-blue-800" onclick="showRegisterForm()">Criar conta</a>
                </div>
                
                <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200 font-medium">
                    <span id="login-btn-text">Entrar</span>
                </button>
            </form>
            
            <!-- Credenciais padrão (para demonstração) -->
            <div class="mt-6 p-4 bg-gray-50 rounded-lg text-sm">
                <p class="font-medium text-gray-800 mb-2">Credenciais padrão:</p>
                <p class="text-gray-600">Usuário: <span class="font-mono">admin</span></p>
                <p class="text-gray-600">Senha: <span class="font-mono">admin123</span></p>
            </div>
        </div>
    </div>
    
    <!-- Tela de Cadastro -->
    <div id="register-screen" class="min-h-screen flex items-center justify-center p-4 bg-gradient-to-br from-purple-500 to-pink-600 hidden">
        <div class="bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md fade-in">
            <div class="text-center mb-8">
                <div class="mx-auto w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mb-4">
                    <i class="fas fa-user-plus text-2xl text-purple-600"></i>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Criar Conta</h1>
                <p class="text-gray-600 mt-2">Cadastre-se no sistema</p>
            </div>
            
            <form id="register-form" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Completo</label>
                    <input type="text" id="reg-fullname" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Digite seu nome completo"/>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Usuário</label>
                    <input type="text" id="reg-username" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Escolha um nome de usuário"/>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                    <div class="relative">
                        <input type="password" id="reg-password" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent pr-12" placeholder="Digite sua senha"/>
                        <button type="button" onclick="toggleRegisterPasswordVisibility()" class="absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700">
                            <i class="fas fa-eye" id="register-password-eye"></i>
                        </button>
                    </div>
                </div>
                
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Confirmar Senha</label>
                    <input type="password" id="reg-confirm-password" required="" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent" placeholder="Confirme sua senha"/>
                </div>
                
                <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition duration-200 font-medium">
                    <span id="register-btn-text">Cadastrar</span>
                </button>
            </form>
            
            <div class="mt-6 text-center">
                <p class="text-sm text-gray-600">
                    Já tem conta? 
                    <button onclick="showLoginForm()" class="text-purple-600 hover:text-purple-800 font-medium">Faça login</button>
                </p>
            </div>
        </div>
    </div>
    
    <!-- Aplicação Principal -->
    <div id="main-app" class="hidden">
        <!-- Header -->
        <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 shadow-lg sticky top-0 z-40">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-lg md:text-xl font-bold">
                        <i class="fas fa-cogs mr-2"></i>
                        Gerenciador de Sistemas
                    </h1>
                    <div class="text-xs md:text-sm mt-1">
                        <span class="connection-status" id="connection-indicator"></span>
                        <span id="connection-status-text">Sistema carregado</span>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <span class="text-sm hidden md:inline">Olá, <span id="user-name">Usuário</span></span>
                    <button onclick="logout()" class="bg-red-500 hover:bg-red-600 px-3 py-1 rounded text-sm transition duration-200">
                        <i class="fas fa-sign-out-alt mr-1"></i>
                        <span class="hidden md:inline">Sair</span>
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="container mx-auto p-4 pb-20 max-w-7xl">
            <!-- Sistema Info Card -->
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6 fade-in">
                <h2 class="text-lg md:text-xl font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-info-circle mr-2 text-blue-600"></i>
                    Informações do Sistema
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="system-info-grid">
                    <!-- Informações serão carregadas dinamicamente -->
                </div>
            </div>

            <!-- Senhas Card -->
            <div class="bg-white rounded-xl shadow-lg p-4 md:p-6 mb-6 fade-in">
                <h2 class="text-lg md:text-xl font-semibold mb-4 text-gray-800 flex items-center">
                    <i class="fas fa-key mr-2 text-green-600"></i>
                    Senhas do Sistema
                </h2>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="passwords-grid">
                    <!-- Senhas serão carregadas dinamicamente -->
                </div>
            </div>

            <!-- Tab Navigation -->
            <div class="bg-white rounded-xl shadow-lg mb-6 fade-in">
                                <div class="flex flex-wrap border-b overflow-x-auto">
                    <button onclick="openTab(event, &#39;menus-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-blue-600 text-blue-600 font-medium whitespace-nowrap">
                        <i class="fas fa-list mr-2"></i>Menus
                    </button>
                    <button onclick="openTab(event, &#39;xml-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap">
                        <i class="fas fa-file-code mr-2"></i>Validar XML
                    </button>
                    <button onclick="openTab(event, &#39;notes-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap">
                        <i class="fas fa-sticky-note mr-2"></i>Anotações
                    </button>
                    <button onclick="openTab(event, &#39;sql-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap">
                        <i class="fas fa-database mr-2"></i>Consultas SQL
                    </button>
                    <button onclick="openTab(event, &#39;users-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap admin-only">
                        <i class="fas fa-users mr-2"></i>Usuários
                    </button>
                                        <button onclick="openTab(event, &#39;attendance-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap">
                        <i class="fas fa-headset mr-2"></i>Atendimento Externo
                    </button>
                    <button onclick="openTab(event, &#39;agenda-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap">
                        <i class="fas fa-calendar-alt mr-2"></i>Minha Agenda
                    </button>
                    <button onclick="openTab(event, &#39;admin-agenda-tab&#39;)" class="tab-button px-4 py-3 border-b-2 border-transparent text-gray-600 hover:text-blue-600 whitespace-nowrap admin-only">
                        <i class="fas fa-users-cog mr-2"></i>Gestão de Agenda
                    </button>
                </div>

                <!-- Tab Contents -->
                <div id="menus-tab" class="tab-content active p-4 md:p-6">
                    <h3 class="text-lg font-semibold mb-4">Gerenciar Menus</h3>
                    <div class="mb-4">
                        <div class="flex flex-col md:flex-row gap-2 mb-2">
                            <input type="text" id="menu-name" placeholder="Nome do menu" class="flex-1 p-3 border rounded-lg"/>
                            <input type="text" id="menu-text" placeholder="Texto do menu" class="flex-1 p-3 border rounded-lg"/>
                            <button onclick="addMenu()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-plus mr-2"></i>Adicionar
                            </button>
                        </div>
                    </div>
                    <div id="menu-list" class="space-y-2">
                        <!-- Menus adicionados aparecerão aqui -->
                    </div>
                </div>

                <div id="xml-tab" class="tab-content p-4 md:p-6">
                    <h3 class="text-lg font-semibold mb-4">Validar XML na SEFAZ-RS</h3>
                    <div class="mb-4">
                        <textarea id="xml-content" placeholder="Cole o conteúdo do XML aqui..." class="w-full h-40 p-3 border rounded-lg font-mono text-sm"></textarea>
                    </div>
                    <div class="flex flex-col sm:flex-row gap-2 mb-4">
                        <button onclick="validateXML()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                            <i class="fas fa-check-circle mr-2"></i>Validar XML
                        </button>
                        <button onclick="formatXML()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                            <i class="fas fa-code mr-2"></i>Formatar XML
                        </button>
                    </div>
                    <div id="xml-result" class="mt-4 hidden"></div>
                </div>

                <div id="notes-tab" class="tab-content p-4 md:p-6">
                    <h3 class="text-lg font-semibold mb-4">Anotações</h3>
                    <div class="mb-4">
                        <div class="flex flex-col md:flex-row gap-2 mb-2">
                            <input type="text" id="note-title" placeholder="Título da anotação" class="flex-1 p-3 border rounded-lg"/>
                            <button onclick="saveNote()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-save mr-2"></i>Salvar
                            </button>
                        </div>
                        <textarea id="notes-area" placeholder="Digite suas anotações aqui..." class="w-full h-40 p-3 border rounded-lg"></textarea>
                    </div>
                    <div id="notes-list" class="space-y-2">
                        <!-- Anotações salvas aparecerão aqui -->
                    </div>
                </div>

                <div id="sql-tab" class="tab-content p-4 md:p-6">
                    <h3 class="text-lg font-semibold mb-4">Consultas SQL Salvas</h3>
                    <div class="mb-4">
                        <div class="flex flex-col md:flex-row gap-2 mb-2">
                            <input type="text" id="query-name" placeholder="Nome da consulta" class="flex-1 p-3 border rounded-lg"/>
                            <button onclick="saveQuery()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                                <i class="fas fa-save mr-2"></i>Salvar
                            </button>
                        </div>
                        <textarea id="sql-query" placeholder="Digite sua consulta SQL aqui..." class="w-full h-32 p-3 border rounded-lg font-mono text-sm"></textarea>
                    </div>
                    <div id="saved-queries" class="space-y-2">
                        <!-- Consultas salvas aparecerão aqui -->
                    </div>
                </div>

                <!-- Tab Usuários (Admin Only) -->
                <div id="users-tab" class="tab-content p-4 md:p-6">
                    <h3 class="text-lg font-semibold mb-4">Gerenciar Usuários</h3>
                    <div class="bg-gray-50 p-4 rounded-lg mb-6">
                        <h4 class="font-medium mb-4">Criar Novo Usuário</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <input type="text" id="new-user-name" placeholder="Nome completo" class="p-3 border rounded-lg"/>
                            <input type="text" id="new-user-username" placeholder="Nome de usuário" class="p-3 border rounded-lg"/>
                            <input type="password" id="new-user-password" placeholder="Senha" class="p-3 border rounded-lg"/>
                            <select id="new-user-role" class="p-3 border rounded-lg">
                                <option value="user">Usuário</option>
                                <option value="admin">Administrador</option>
                            </select>
                        </div>
                        <div class="mb-4">
                            <h5 class="font-medium mb-2">Permissões:</h5>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-menus" class="mr-2" checked=""/>
                                    <span class="text-sm">Gerenciar Menus</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-xml" class="mr-2" checked=""/>
                                    <span class="text-sm">Validar XML</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-notes" class="mr-2" checked=""/>
                                    <span class="text-sm">Anotações</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-sql" class="mr-2" checked=""/>
                                    <span class="text-sm">Consultas SQL</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-database" class="mr-2" checked=""/>
                                    <span class="text-sm">Banco de Dados</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-downloads" class="mr-2" checked=""/>
                                    <span class="text-sm">Downloads</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-sites" class="mr-2" checked=""/>
                                    <span class="text-sm">Sites Úteis</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" id="perm-attendance" class="mr-2" checked=""/>
                                    <span class="text-sm">Atendimento</span>
                                </label>
                            </div>
                        </div>
                        <button onclick="createUser()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                            <i class="fas fa-user-plus mr-2"></i>Criar Usuário
                        </button>
                    </div>
                    <div id="users-list" class="space-y-2">
                        <!-- Lista de usuários aparecerá aqui -->
                    </div>
                </div>

                <!-- Tab Atendimento Externo -->
                <div id="attendance-tab" class="tab-content p-4 md:p-6">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Anotações de Atendimento -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4">Anotações de Atendimento</h3>
                            <div class="space-y-4 mb-4">
                                <input type="text" id="client-cnpj" placeholder="CNPJ do Cliente" class="w-full p-3 border rounded-lg" maxlength="18"/>
                                <input type="text" id="attendance-title" placeholder="Título do atendimento" class="w-full p-3 border rounded-lg"/>
                                <textarea id="attendance-notes" placeholder="Anotações do atendimento..." class="w-full h-32 p-3 border rounded-lg"></textarea>
                                <button onclick="saveAttendanceNote()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Salvar Atendimento
                                </button>
                            </div>
                            <div id="attendance-notes-list" class="space-y-2 max-h-96 overflow-y-auto">
                                <!-- Anotações de atendimento aparecerão aqui -->
                            </div>
                        </div>

                        <!-- Sistema de Tarefas To-Do -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4">Tarefas (To-Do)</h3>
                            <div class="mb-4">
                                <div class="flex flex-col gap-2 mb-2">
                                    <input type="text" id="task-title" placeholder="Título da tarefa" class="w-full p-3 border rounded-lg"/>
                                    <textarea id="task-description" placeholder="Descrição da tarefa..." class="w-full h-20 p-3 border rounded-lg"></textarea>
                                    <input type="file" id="task-files" multiple="" accept="image/*,*/*" class="w-full p-2 border rounded-lg"/>
                                    <button onclick="createTask()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                                        <i class="fas fa-plus mr-2"></i>Criar Tarefa
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Kanban Board -->
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3">
                                    <h4 class="font-medium text-yellow-800 mb-3 text-center">
                                        <i class="fas fa-clock mr-2"></i>A Fazer
                                    </h4>
                                    <div id="todo-column" class="space-y-2 min-h-32" ondrop="drop(event)" ondragover="allowDrop(event)" data-status="todo">
                                        <!-- Tarefas "A Fazer" aparecerão aqui -->
                                    </div>
                                </div>
                                
                                <div class="bg-blue-50 border border-blue-200 rounded-lg p-3">
                                    <h4 class="font-medium text-blue-800 mb-3 text-center">
                                        <i class="fas fa-play mr-2"></i>Em Andamento
                                    </h4>
                                    <div id="progress-column" class="space-y-2 min-h-32" ondrop="drop(event)" ondragover="allowDrop(event)" data-status="progress">
                                        <!-- Tarefas "Em Andamento" aparecerão aqui -->
                                    </div>
                                </div>
                                
                                <div class="bg-green-50 border border-green-200 rounded-lg p-3">
                                    <h4 class="font-medium text-green-800 mb-3 text-center">
                                        <i class="fas fa-check mr-2"></i>Concluído
                                    </h4>
                                    <div id="done-column" class="space-y-2 min-h-32" ondrop="drop(event)" ondragover="allowDrop(event)" data-status="done">
                                        <!-- Tarefas "Concluído" aparecerão aqui -->
                                    </div>
                                </div>
                            </div>                        </div>
                    </div>
                </div>

                <!-- Tab Minha Agenda -->
                <div id="agenda-tab" class="tab-content p-4 md:p-6">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Minhas Tarefas da Agenda -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-tasks mr-2 text-blue-600"></i>
                                Minhas Tarefas
                            </h3>
                            <div class="space-y-4 mb-4">
                                <input type="text" id="personal-task-title" placeholder="Título da tarefa" class="w-full p-3 border rounded-lg"/>
                                <textarea id="personal-task-description" placeholder="Descrição da tarefa..." class="w-full h-24 p-3 border rounded-lg"></textarea>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <input type="date" id="personal-task-date" class="w-full p-3 border rounded-lg"/>
                                    <input type="time" id="personal-task-time" class="w-full p-3 border rounded-lg"/>
                                </div>
                                <select id="personal-task-priority" class="w-full p-3 border rounded-lg">
                                    <option value="baixa">Prioridade Baixa</option>
                                    <option value="media" selected="">Prioridade Média</option>
                                    <option value="alta">Prioridade Alta</option>
                                    <option value="urgente">Urgente</option>
                                </select>
                                <button onclick="addPersonalTask()" class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-200 w-full">
                                    <i class="fas fa-plus mr-2"></i>Adicionar à Agenda
                                </button>
                            </div>
                            
                            <!-- Lista de Tarefas Pessoais -->
                            <div id="personal-tasks-list" class="space-y-2 max-h-96 overflow-y-auto">
                                <!-- Tarefas pessoais aparecerão aqui -->
                            </div>
                        </div>

                        <!-- Minha Escala de Trabalho -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-clock mr-2 text-green-600"></i>
                                Minha Escala de Trabalho
                            </h3>
                            
                            <!-- Configurar Horário Padrão -->
                            <div class="bg-gray-50 p-4 rounded-lg mb-4">
                                <h4 class="font-medium mb-3">Configurar Horário Padrão</h4>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Entrada:</label>
                                        <input type="time" id="default-start-time" class="w-full p-2 border rounded-lg" value="08:00"/>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-gray-700 mb-1">Saída:</label>
                                        <input type="time" id="default-end-time" class="w-full p-2 border rounded-lg" value="17:00"/>
                                    </div>
                                </div>
                                <button onclick="saveDefaultSchedule()" class="mt-3 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200">
                                    <i class="fas fa-save mr-2"></i>Salvar Padrão
                                </button>
                            </div>

                            <!-- Adicionar Escala Específica -->
                            <div class="space-y-3 mb-4">
                                <input type="date" id="schedule-date" class="w-full p-3 border rounded-lg"/>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="time" id="schedule-start" class="w-full p-3 border rounded-lg" placeholder="Entrada"/>
                                    <input type="time" id="schedule-end" class="w-full p-3 border rounded-lg" placeholder="Saída"/>
                                </div>
                                <input type="text" id="schedule-notes" placeholder="Observações (opcional)" class="w-full p-3 border rounded-lg"/>
                                <button onclick="addScheduleEntry()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200 w-full">
                                    <i class="fas fa-calendar-plus mr-2"></i>Adicionar à Escala
                                </button>
                            </div>

                            <!-- Visualização da Escala -->
                            <div id="personal-schedule-list" class="space-y-2 max-h-64 overflow-y-auto">
                                <!-- Escala pessoal aparecerá aqui -->
                            </div>
                        </div>
                    </div>

                    <!-- Calendário Visual (Resumido) -->
                    <div class="bg-white border rounded-lg p-4 mt-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-calendar mr-2 text-purple-600"></i>
                            Visão Mensal - <span id="calendar-month-year"></span>
                        </h3>
                        <div class="flex justify-between items-center mb-4">
                            <button onclick="changeMonth(-1)" class="bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <button onclick="goToToday()" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
                                Hoje
                            </button>
                            <button onclick="changeMonth(1)" class="bg-gray-200 text-gray-700 px-3 py-1 rounded hover:bg-gray-300">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                        <div id="calendar-grid" class="grid grid-cols-7 gap-1 text-center">
                            <!-- Calendário será gerado dinamicamente -->
                        </div>
                    </div>
                </div>

                <!-- Tab Gestão de Agenda (Admin Only) -->
                <div id="admin-agenda-tab" class="tab-content p-4 md:p-6">
                    <div class="grid grid-cols-1 xl:grid-cols-2 gap-6">
                        <!-- Atribuir Tarefas aos Usuários -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-user-plus mr-2 text-red-600"></i>
                                Atribuir Tarefas aos Usuários
                            </h3>
                            <div class="space-y-4 mb-4">
                                <select id="assign-user-select" class="w-full p-3 border rounded-lg">
                                    <option value="">Selecionar usuário...</option>
                                </select>
                                <input type="text" id="assign-task-title" placeholder="Título da tarefa" class="w-full p-3 border rounded-lg"/>
                                <textarea id="assign-task-description" placeholder="Descrição da tarefa..." class="w-full h-24 p-3 border rounded-lg"></textarea>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-2">
                                    <input type="date" id="assign-task-date" class="w-full p-3 border rounded-lg"/>
                                    <input type="time" id="assign-task-time" class="w-full p-3 border rounded-lg"/>
                                </div>
                                <select id="assign-task-priority" class="w-full p-3 border rounded-lg">
                                    <option value="baixa">Prioridade Baixa</option>
                                    <option value="media" selected="">Prioridade Média</option>
                                    <option value="alta">Prioridade Alta</option>
                                    <option value="urgente">Urgente</option>
                                </select>
                                <button onclick="assignTaskToUser()" class="bg-red-600 text-white px-6 py-3 rounded-lg hover:bg-red-700 transition duration-200 w-full">
                                    <i class="fas fa-paper-plane mr-2"></i>Atribuir Tarefa
                                </button>
                            </div>
                        </div>

                        <!-- Gerenciar Escalas dos Usuários -->
                        <div class="bg-white border rounded-lg p-4">
                            <h3 class="text-lg font-semibold mb-4 flex items-center">
                                <i class="fas fa-users-cog mr-2 text-purple-600"></i>
                                Gerenciar Escalas
                            </h3>
                            <div class="space-y-4 mb-4">
                                <select id="schedule-user-select" class="w-full p-3 border rounded-lg">
                                    <option value="">Selecionar usuário...</option>
                                </select>
                                <input type="date" id="admin-schedule-date" class="w-full p-3 border rounded-lg"/>
                                <div class="grid grid-cols-2 gap-2">
                                    <input type="time" id="admin-schedule-start" class="w-full p-3 border rounded-lg" placeholder="Entrada"/>
                                    <input type="time" id="admin-schedule-end" class="w-full p-3 border rounded-lg" placeholder="Saída"/>
                                </div>
                                <input type="text" id="admin-schedule-notes" placeholder="Observações" class="w-full p-3 border rounded-lg"/>
                                <button onclick="setUserSchedule()" class="bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition duration-200 w-full">
                                    <i class="fas fa-calendar-check mr-2"></i>Definir Escala
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Mural de Escalas -->
                    <div class="bg-white border rounded-lg p-4 mt-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-clipboard-list mr-2 text-indigo-600"></i>
                            Mural de Escalas - Próximos 7 Dias
                        </h3>
                        <div id="schedule-board" class="space-y-3">
                            <!-- Mural de escalas aparecerá aqui -->
                        </div>
                    </div>

                    <!-- Estatísticas e Relatórios -->
                    <div class="bg-white border rounded-lg p-4 mt-6">
                        <h3 class="text-lg font-semibold mb-4 flex items-center">
                            <i class="fas fa-chart-bar mr-2 text-orange-600"></i>
                            Relatórios de Agenda
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-blue-600" id="total-active-tasks">0</div>
                                <div class="text-sm text-blue-700">Tarefas Ativas</div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-green-600" id="users-working-today">0</div>
                                <div class="text-sm text-green-700">Usuários Trabalhando Hoje</div>
                            </div>
                            <div class="bg-red-50 p-4 rounded-lg text-center">
                                <div class="text-2xl font-bold text-red-600" id="overdue-tasks">0</div>
                                <div class="text-sm text-red-700">Tarefas Atrasadas</div>
                            </div>
                        </div>
                        <button onclick="generateAgendaReport()" class="mt-4 bg-orange-600 text-white px-6 py-3 rounded-lg hover:bg-orange-700 transition duration-200">
                            <i class="fas fa-file-export mr-2"></i>Gerar Relatório Completo
                        </button>
                    </div>
                </div>
            </div>
        </main>

        <!-- Bottom Navigation -->
        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-2 py-1 shadow-lg z-30">
            <div class="flex justify-around items-center max-w-md mx-auto">
                <button onclick="openBottomTab(&#39;tools&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-tools text-lg"></i>
                    <span class="text-xs mt-1">Ferramentas</span>
                </button>
                <button onclick="openBottomTab(&#39;database&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-database text-lg"></i>
                    <span class="text-xs mt-1">Banco</span>
                </button>
                <button onclick="openBottomTab(&#39;downloads&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-download text-lg"></i>
                    <span class="text-xs mt-1">Downloads</span>
                </button>
                <button onclick="openBottomTab(&#39;sites&#39;)" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-globe text-lg"></i>
                    <span class="text-xs mt-1">Sites</span>
                </button>
                <button onclick="toggleQueryMenu()" class="flex flex-col items-center p-2 text-gray-600 hover:text-blue-600 transition duration-200">
                    <i class="fas fa-play text-lg"></i>
                    <span class="text-xs mt-1">SQL</span>
                </button>
            </div>
        </nav>

        <!-- Floating Query Menu -->
        <div id="query-menu" class="floating-menu" style="display: none;">
            <div class="menu-item">
                <button onclick="openQueryExecutor(&#39;sql&#39;)" class="bg-blue-600 text-white p-3 rounded-full shadow-lg hover:bg-blue-700 transition duration-200" title="SQL Server">
                    <i class="fas fa-database"></i>
                </button>
            </div>
            <div class="menu-item">
                <button onclick="openQueryExecutor(&#39;postgres&#39;)" class="bg-green-600 text-white p-3 rounded-full shadow-lg hover:bg-green-700 transition duration-200" title="PostgreSQL">
                    <i class="fab fa-envira"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Modals -->
    <!-- Database Connection Modal -->
    <div id="db-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md max-h-screen overflow-y-auto">
                <h3 class="text-xl font-semibold mb-6 text-center">Conectar ao Banco de Dados</h3>
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Tipo do Banco</label>
                        <select id="db-type" class="w-full p-3 border rounded-lg">
                            <option value="sql">SQL Server</option>
                            <option value="postgres">PostgreSQL</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Host</label>
                        <input type="text" id="db-host" placeholder="localhost" class="w-full p-3 border rounded-lg"/>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Porta</label>
                        <input type="text" id="db-port" placeholder="1433 para SQL, 5432 para PostgreSQL" class="w-full p-3 border rounded-lg"/>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Nome do Banco</label>
                        <input type="text" id="db-name-input" placeholder="Nome do banco" class="w-full p-3 border rounded-lg"/>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Usuário</label>
                        <input type="text" id="db-user" placeholder="Usuário do banco" class="w-full p-3 border rounded-lg"/>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Senha</label>
                        <input type="password" id="db-password-input" placeholder="Senha do banco" class="w-full p-3 border rounded-lg"/>
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" id="save-connection" class="mr-2 rounded"/>
                        <label for="save-connection" class="text-sm text-gray-700">Salvar conexão</label>
                    </div>
                </div>
                <div class="flex flex-col sm:flex-row gap-2 mt-6">
                    <button onclick="connectDatabase()" class="flex-1 bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                        <span class="connection-btn-text">Conectar</span>
                    </button>
                    <button onclick="testConnection()" class="bg-orange-600 text-white px-4 py-3 rounded-lg hover:bg-orange-700 transition duration-200">
                        Testar
                    </button>
                    <button onclick="closeModal(&#39;db-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition duration-200">
                        Cancelar
                    </button>
                </div>
                <div id="connection-test-result" class="mt-4 hidden"></div>
            </div>
        </div>
    </div>

    <!-- Query Executor Modal -->
    <div id="query-executor-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-6xl max-h-screen overflow-y-auto">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-semibold">Executor de Consultas SQL</h3>
                    <div class="flex items-center gap-4">
                        <div class="text-sm">
                            <span class="connection-status" id="executor-connection-indicator"></span>
                            <span id="executor-connection-text">Desconectado</span>
                        </div>
                        <button onclick="reconnectDatabase()" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700 transition duration-200">
                            Reconectar
                        </button>
                    </div>
                </div>
                
                <div class="mb-4">
                    <div class="flex flex-col lg:flex-row gap-2 mb-2">
                        <select id="saved-query-select" class="flex-1 p-3 border rounded-lg">
                            <option value="">Selecionar consulta salva...</option>
                        </select>
                        <button onclick="loadSavedQuery()" class="bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition duration-200">
                            Carregar
                        </button>
                    </div>
                    <textarea id="execute-query" placeholder="Digite sua consulta SQL aqui..." class="w-full h-40 p-3 border rounded-lg font-mono text-sm"></textarea>
                    <div class="flex flex-wrap gap-2 items-center mt-2">
                        <button onclick="executeQuery()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition duration-200" id="execute-btn">
                            <i class="fas fa-play mr-2"></i>Executar
                        </button>
                        <button onclick="formatQuerySQL()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                            <i class="fas fa-code mr-2"></i>Formatar
                        </button>
                        <button onclick="clearQuery()" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition duration-200">
                            <i class="fas fa-trash mr-2"></i>Limpar
                        </button>
                        <span class="text-sm text-gray-600" id="query-stats"></span>
                    </div>
                </div>
                
                <div class="flex flex-wrap gap-2 mb-4">
                    <button onclick="closeModal(&#39;query-executor-modal&#39;)" class="bg-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-400 transition duration-200">
                        Fechar
                    </button>
                    <button onclick="exportResults()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200" id="export-btn" style="display: none;">
                        <i class="fas fa-download mr-2"></i>Exportar CSV
                    </button>
                </div>
                
                <div id="query-results" class="border rounded-lg bg-gray-50 min-h-32 max-h-96 overflow-auto">
                    <div class="p-4 text-gray-500 text-center">
                        <i class="fas fa-database mr-2"></i>Os resultados da consulta aparecerão aqui...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Downloads Modal -->
    <div id="downloads-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md max-h-screen overflow-y-auto">
                <h3 class="text-xl font-semibold mb-6 text-center">Gerenciar Downloads</h3>
                <div class="space-y-4 mb-6">
                    <input type="text" id="download-name" placeholder="Nome do arquivo" class="w-full p-3 border rounded-lg"/>
                    <input type="url" id="download-url" placeholder="URL do arquivo" class="w-full p-3 border rounded-lg"/>
                    <input type="file" id="upload-file" class="w-full p-3 border rounded-lg" multiple=""/>
                    <button onclick="addDownload()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i>Adicionar Download
                    </button>
                </div>
                <div id="downloads-list" class="space-y-2 max-h-64 overflow-y-auto mb-4">
                    <!-- Lista de downloads aparecerá aqui -->
                </div>
                <div class="flex gap-2">
                    <button onclick="clearAllDownloads()" class="flex-1 bg-red-600 text-white py-3 rounded-lg hover:bg-red-700 transition duration-200">
                        Limpar Tudo
                    </button>
                    <button onclick="closeModal(&#39;downloads-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition duration-200">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Sites Úteis Modal -->
    <div id="sites-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md max-h-screen overflow-y-auto">
                <h3 class="text-xl font-semibold mb-6 text-center">Sites Úteis</h3>
                <div class="space-y-4 mb-6" id="admin-controls">
                    <input type="text" id="site-name" placeholder="Nome do site" class="w-full p-3 border rounded-lg"/>
                    <input type="url" id="site-url" placeholder="URL do site" class="w-full p-3 border rounded-lg"/>
                    <button onclick="addSite()" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition duration-200">
                        <i class="fas fa-plus mr-2"></i>Adicionar Site
                    </button>
                </div>
                <div id="sites-list" class="space-y-2 max-h-64 overflow-y-auto mb-4">
                    <!-- Lista de sites aparecerá aqui -->
                </div>
                <div class="flex flex-wrap gap-2">
                    <button onclick="importSites()" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition duration-200" id="import-sites-btn">
                        <i class="fas fa-upload mr-2"></i>Importar
                    </button>
                    <button onclick="exportSites()" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition duration-200">
                        <i class="fas fa-download mr-2"></i>Exportar
                    </button>
                    <button onclick="closeModal(&#39;sites-modal&#39;)" class="flex-1 bg-gray-300 text-gray-700 py-3 rounded-lg hover:bg-gray-400 transition duration-200">
                        Fechar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Banner de Instalação PWA -->
    <div id="install-banner" class="install-banner">
        <div class="flex items-center justify-between">
            <div class="flex items-center">
                <i class="fas fa-mobile-alt text-2xl mr-3"></i>
                <div>
                    <div class="font-semibold">Instalar Aplicativo</div>
                    <div class="text-sm opacity-90">Adicione à tela inicial para acesso rápido</div>
                </div>
            </div>
            <div class="flex gap-2">
                <button onclick="installPWA()" class="bg-white text-blue-600 px-4 py-2 rounded font-medium hover:bg-blue-50 transition duration-200">
                    Instalar
                </button>
                <button onclick="dismissInstallBanner()" class="text-white hover:text-blue-200 p-2">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl text-center">
            <div class="loading-spinner mx-auto mb-4"></div>
            <div class="text-lg font-semibold text-gray-800" id="loading-text">Carregando...</div>
        </div>
    </div>

    <script>
        // =============================
        // VARIÁVEIS GLOBAIS
        // =============================
        
        let currentUser = null;
        let users = [];
        let systemInfo = {};
        let passwords = {};
        let menus = [];
        let notes = [];
        let savedQueries = [];
        let downloads = [];
        let sites = [];
        let connectionStatus = 'disconnected';
        let currentConnection = null;
        let pwaPrompt = null;
        let attendanceNotes = [];        let tasks = [];
        let draggedElement = null;
        let personalTasks = [];
        let personalSchedules = [];
        let assignedTasks = [];
        let userSchedules = {};
        let currentCalendarDate = new Date();
        let defaultWorkSchedule = { start: '08:00', end: '17:00' };
        
        // =============================
        // INICIALIZAÇÃO
        // =============================
        
        document.addEventListener('DOMContentLoaded', function() {
            initializeApplication();
        });
        
        function initializeApplication() {
            try {
                console.log('Inicializando aplicação...');
                
                // Inicializar usuários padrão
                initDefaultUsers();
                
                // Verificar se está logado
                checkLoginStatus();
                
                // Configurar PWA
                setupPWA();
                
                // Carregar informações do sistema
                loadSystemInfo();
                
                // Carregar senhas
                loadPasswords();
                
                console.log('Aplicação inicializada com sucesso');
                
            } catch (error) {
                console.error('Erro na inicialização:', error);
                showToast('Erro ao inicializar aplicação', 'error');
            }
        }
        
        function initDefaultUsers() {
            const savedUsers = localStorage.getItem('users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
            } else {
                users = [
                    {
                        id: 1,
                        username: 'admin',
                        password: 'admin123',
                        fullName: 'Administrador',
                        role: 'admin',
                        createdAt: new Date().toISOString()
                    }
                ];
                localStorage.setItem('users', JSON.stringify(users));
            }
        }
        
        function checkLoginStatus() {
            const savedUser = localStorage.getItem('currentUser');
            if (savedUser) {
                currentUser = JSON.parse(savedUser);
                showMainApp();
            } else {
                showLoginScreen();
            }
        }
        
        // =============================
        // FUNÇÕES DE TELA
        // =============================
        
        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }
        
        function showRegisterForm() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.remove('hidden');
        }
        
        function showLoginForm() {
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('login-screen').classList.remove('hidden');
        }
        
        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('register-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
            
            // Atualizar nome do usuário
            if (currentUser) {
                document.getElementById('user-name').textContent = currentUser.fullName || currentUser.username;
            }
            
            // Configurar controles admin
            setupAdminControls();
            
            // Carregar dados
            loadAllData();
        }
        
        // =============================
        // AUTENTICAÇÃO
        // =============================
        
        document.getElementById('login-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value;
            const btnText = document.getElementById('login-btn-text');
            
            if (!username || !password) {
                showToast('Preencha todos os campos', 'warning');
                return;
            }
            
            btnText.innerHTML = '<span class="spinner"></span>Entrando...';
            
            setTimeout(() => {
                const user = users.find(u => u.username === username && u.password === password);
                
                if (user) {
                    currentUser = user;
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    showToast('Login realizado com sucesso!', 'success');
                    
                    setTimeout(() => {
                        showMainApp();
                    }, 1000);
                } else {
                    showToast('Usuário ou senha inválidos', 'error');
                }
                
                btnText.textContent = 'Entrar';
            }, 1000);
        });
        
        document.getElementById('register-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('reg-fullname').value.trim();
            const username = document.getElementById('reg-username').value.trim();
            const password = document.getElementById('reg-password').value;
            const confirmPassword = document.getElementById('reg-confirm-password').value;
            const btnText = document.getElementById('register-btn-text');
            
            if (!fullName || !username || !password || !confirmPassword) {
                showToast('Preencha todos os campos', 'warning');
                return;
            }
            
            if (password !== confirmPassword) {
                showToast('As senhas não coincidem', 'error');
                return;
            }
            
            if (password.length < 6) {
                showToast('A senha deve ter pelo menos 6 caracteres', 'error');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                showToast('Usuário já existe', 'error');
                return;
            }
            
            btnText.innerHTML = '<span class="spinner"></span>Cadastrando...';
            
            setTimeout(() => {
                const newUser = {
                    id: Date.now(),
                    username,
                    password,
                    fullName,
                    role: 'user',
                    createdAt: new Date().toISOString()
                };
                
                users.push(newUser);
                localStorage.setItem('users', JSON.stringify(users));
                
                showToast('Cadastro realizado com sucesso! Faça login.', 'success');
                
                setTimeout(() => {
                    showLoginForm();
                }, 1500);
                
                btnText.textContent = 'Cadastrar';
            }, 1000);
        });
        
        function logout() {
            if (confirm('Tem certeza que deseja sair?')) {
                currentUser = null;
                localStorage.removeItem('currentUser');
                showLoginScreen();
                showToast('Logout realizado com sucesso!', 'success');
            }
        }
        
        // =============================
        // FUNÇÕES DE SENHA
        // =============================
        
        function toggleLoginPasswordVisibility() {
            const passwordInput = document.getElementById('password');
            const eyeIcon = document.getElementById('login-password-eye');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }
        
        function toggleRegisterPasswordVisibility() {
            const passwordInput = document.getElementById('reg-password');
            const eyeIcon = document.getElementById('register-password-eye');
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                eyeIcon.classList.remove('fa-eye');
                eyeIcon.classList.add('fa-eye-slash');
            } else {
                passwordInput.type = 'password';
                eyeIcon.classList.remove('fa-eye-slash');
                eyeIcon.classList.add('fa-eye');
            }
        }
        
        function togglePasswordVisibility(passwordId) {
            const passwordElement = document.getElementById(passwordId);
            const eyeElement = document.getElementById(passwordId + '-eye');
            const actualPassword = passwordElement.getAttribute('data-password');
            
            if (passwordElement.classList.contains('password-hidden')) {
                passwordElement.textContent = actualPassword;
                passwordElement.classList.remove('password-hidden');
                eyeElement.classList.remove('fa-eye');
                eyeElement.classList.add('fa-eye-slash');
            } else {
                passwordElement.textContent = '•'.repeat(actualPassword.length);
                passwordElement.classList.add('password-hidden');
                eyeElement.classList.remove('fa-eye-slash');
                eyeElement.classList.add('fa-eye');
            }
        }
        
        function copyPassword(passwordId) {
            const passwordElement = document.getElementById(passwordId);
            const password = passwordElement.getAttribute('data-password');
            copyToClipboard(password);
        }
        
        // =============================
        // SISTEMA DE INFORMAÇÕES
        // =============================
        
        function loadSystemInfo() {
            // Gerar senha dinâmica
            const now = new Date();
            const day = now.getDate();
            const month = now.getMonth() + 1;
            const yearSuffix = parseInt(now.getFullYear().toString().slice(-2));
            const sum = day + month + yearSuffix;
            
            systemInfo = {
                dynamicPassword: `AdmPwd20${sum}`,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                languages: navigator.languages ? navigator.languages.join(', ') : 'N/A',
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                hardwareConcurrency: navigator.hardwareConcurrency || 'N/A',
                deviceMemory: navigator.deviceMemory ? `${navigator.deviceMemory} GB` : 'N/A',
                maxTouchPoints: navigator.maxTouchPoints || 0,
                screenWidth: screen.width,
                screenHeight: screen.height,
                availWidth: screen.availWidth,
                availHeight: screen.availHeight,
                colorDepth: screen.colorDepth,
                pixelDepth: screen.pixelDepth,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                currentTime: new Date().toLocaleString('pt-BR')
            };
            
            // Tentar obter IP público
            getPublicIP();
            
            // Tentar obter IP local
            getLocalIP();
            
            // Atualizar display
            updateSystemInfoDisplay();
        }
        
                function getPublicIP() {
            // Múltiplas APIs para IP público
            const ipAPIs = [
                'https://api.ipify.org?format=json',
                'https://ipapi.co/json/',
                'https://ip.seeip.org/jsonip?',
                'https://httpbin.org/ip',
                'https://api.myip.com'
            ];
            
            let apiIndex = 0;
            
            function tryNextAPI() {
                if (apiIndex >= ipAPIs.length) {
                    systemInfo.publicIP = 'Não disponível';
                    updateSystemInfoDisplay();
                    return;
                }
                
                const currentAPI = ipAPIs[apiIndex];
                console.log(`Tentando API ${apiIndex + 1}: ${currentAPI}`);
                
                fetch(currentAPI, { 
                    timeout: 5000,
                    headers: {
                        'Accept': 'application/json'
                    }
                })
                .then(response => {
                    if (!response.ok) throw new Error('API response not ok');
                    return response.json();
                })
                .then(data => {
                    let ip = null;
                    // Diferentes formatos de resposta das APIs
                    if (data.ip) ip = data.ip;
                    else if (data.origin) ip = data.origin;
                    else if (data.query) ip = data.query;
                    else if (typeof data === 'string') ip = data;
                    
                    if (ip && isValidIP(ip)) {
                        systemInfo.publicIP = ip;
                        console.log(`IP público obtido: ${ip}`);
                        updateSystemInfoDisplay();
                    } else {
                        throw new Error('Invalid IP format');
                    }
                })
                .catch(error => {
                    console.log(`Erro na API ${apiIndex + 1}:`, error);
                    apiIndex++;
                    tryNextAPI();
                });
            }
            
            tryNextAPI();
        }
        
        function getLocalIP() {
            // Método 1: WebRTC
            try {
                const pc = new RTCPeerConnection({
                    iceServers: [
                        { urls: 'stun:stun.l.google.com:19302' },
                        { urls: 'stun:stun1.l.google.com:19302' }
                    ]
                });
                
                pc.createDataChannel('');
                
                pc.onicecandidate = (ice) => {
                    if (!ice || !ice.candidate || !ice.candidate.candidate) return;
                    
                    const candidate = ice.candidate.candidate;
                    const ipMatch = candidate.match(/([0-9]{1,3}(\.[0-9]{1,3}){3})/);
                    
                    if (ipMatch && ipMatch[1]) {
                        const ip = ipMatch[1];
                        // Filtrar IPs locais válidos (não loopback, não link-local)
                        if (isValidLocalIP(ip)) {
                            systemInfo.localIP = ip;
                            console.log(`IP local obtido: ${ip}`);
                            updateSystemInfoDisplay();
                            pc.onicecandidate = () => {}; // Parar após o primeiro IP válido
                        }
                    }
                };
                
                pc.createOffer()
                    .then(pc.setLocalDescription.bind(pc))
                    .catch(error => {
                        console.log('Erro no WebRTC:', error);
                        fallbackLocalIP();
                    });
                
                // Timeout para WebRTC
                setTimeout(() => {
                    if (!systemInfo.localIP) {
                        console.log('WebRTC timeout, tentando fallback...');
                        fallbackLocalIP();
                    }
                }, 3000);
                
            } catch (error) {
                console.log('WebRTC não suportado:', error);
                fallbackLocalIP();
            }
        }
        
        function fallbackLocalIP() {
            // Método 2: Tentar obter informações de rede via navigator
            if (navigator.connection && navigator.connection.effectiveType) {
                console.log('Tipo de conexão:', navigator.connection.effectiveType);
                
                // Método 3: Usar fetch para detectar IP através de erro CORS
                fetch('http://192.168.1.1:80', { mode: 'no-cors', timeout: 1000 })
                    .catch(() => {
                        // Tentar ranges comuns de IP local
                        const commonRanges = [
                            '192.168.1.',
                            '192.168.0.',
                            '10.0.0.',
                            '172.16.0.'
                        ];
                        
                        // Simular detecção baseada no horário (fallback)
                        const now = new Date();
                        const range = commonRanges[now.getSeconds() % commonRanges.length];
                        const lastOctet = (now.getMinutes() % 254) + 1;
                        systemInfo.localIP = range + lastOctet;
                        console.log(`IP local estimado: ${systemInfo.localIP}`);
                        updateSystemInfoDisplay();
                    });
            } else {
                systemInfo.localIP = 'Não disponível';
                updateSystemInfoDisplay();
            }
        }
        
        function isValidIP(ip) {
            const ipRegex = /^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/;
            return ipRegex.test(ip);
        }
        
        function isValidLocalIP(ip) {
            // Verificar se é um IP local válido (não loopback, não link-local)
            if (!isValidIP(ip)) return false;
            
            const parts = ip.split('.').map(Number);
            
            // Excluir loopback (127.x.x.x)
            if (parts[0] === 127) return false;
            
            // Excluir link-local (169.254.x.x)
            if (parts[0] === 169 && parts[1] === 254) return false;
            
            // Aceitar redes privadas
            // 10.0.0.0/8
            if (parts[0] === 10) return true;
            
            // 172.16.0.0/12
            if (parts[0] === 172 && parts[1] >= 16 && parts[1] <= 31) return true;
            
            // 192.168.0.0/16
            if (parts[0] === 192 && parts[1] === 168) return true;
            
            return false;
        }
        
        function getBrowserInfo() {
            const ua = navigator.userAgent;
            if (ua.includes('Chrome') && !ua.includes('Edg')) return 'Google Chrome';
            if (ua.includes('Firefox')) return 'Mozilla Firefox';
            if (ua.includes('Safari') && !ua.includes('Chrome')) return 'Safari';
            if (ua.includes('Edg')) return 'Microsoft Edge';
            if (ua.includes('Opera')) return 'Opera';
            return 'Navegador desconhecido';
        }
        
        function getOSInfo() {
            const ua = navigator.userAgent;
            if (ua.includes('Windows NT 10.0')) return 'Windows 10/11';
            if (ua.includes('Windows NT 6.3')) return 'Windows 8.1';
            if (ua.includes('Windows NT 6.1')) return 'Windows 7';
            if (ua.includes('Windows')) return 'Windows';
            if (ua.includes('Mac OS X')) {
                const version = ua.match(/Mac OS X ([0-9_]+)/);
                return version ? `macOS ${version[1].replace(/_/g, '.')}` : 'macOS';
            }
            if (ua.includes('Linux') && !ua.includes('Android')) return 'Linux';
            if (ua.includes('Android')) {
                const version = ua.match(/Android ([0-9.]+)/);
                return version ? `Android ${version[1]}` : 'Android';
            }
            if (ua.includes('iOS')) return 'iOS';
            return 'Sistema desconhecido';
        }
        
        function updateSystemInfoDisplay() {
            const grid = document.getElementById('system-info-grid');
            if (!grid) return;
            
            const infoItems = [
                { label: 'IP Público', value: systemInfo.publicIP || 'Carregando...', icon: 'fa-globe' },
                { label: 'IP Local', value: systemInfo.localIP || 'Carregando...', icon: 'fa-home' },
                { label: 'Navegador', value: getBrowserInfo(), icon: 'fa-chrome' },
                { label: 'Sistema Operacional', value: getOSInfo(), icon: 'fa-desktop' },
                { label: 'Plataforma', value: systemInfo.platform, icon: 'fa-microchip' },
                { label: 'Idioma', value: systemInfo.language, icon: 'fa-language' },
                { label: 'Timezone', value: systemInfo.timezone, icon: 'fa-clock' },
                { label: 'Resolução da Tela', value: `${systemInfo.screenWidth}x${systemInfo.screenHeight}`, icon: 'fa-tv' },
                { label: 'Área Disponível', value: `${systemInfo.availWidth}x${systemInfo.availHeight}`, icon: 'fa-expand' },
                { label: 'Profundidade de Cor', value: `${systemInfo.colorDepth} bits`, icon: 'fa-palette' },
                { label: 'Cores Lógicos CPU', value: systemInfo.hardwareConcurrency, icon: 'fa-microchip' },
                { label: 'Memória RAM', value: systemInfo.deviceMemory, icon: 'fa-memory' },
                { label: 'Pontos de Toque', value: systemInfo.maxTouchPoints, icon: 'fa-hand-pointer' },
                { label: 'Status Online', value: systemInfo.onLine ? 'Online' : 'Offline', icon: 'fa-signal' },
                { label: 'Cookies Habilitados', value: systemInfo.cookieEnabled ? 'Sim' : 'Não', icon: 'fa-cookie' },
                { label: 'Data/Hora Atual', value: systemInfo.currentTime, icon: 'fa-calendar-alt' }
            ];
            
            grid.innerHTML = infoItems.map(item => `
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-sm font-medium text-gray-700">
                            <i class="fas ${item.icon} mr-2 text-blue-600"></i>
                            ${item.label}:
                        </label>
                        <button onclick="copyToClipboard('${item.value}')" class="text-blue-600 hover:text-blue-800 text-sm">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                    <div class="text-gray-800 text-sm break-all">
                        ${item.value}
                    </div>
                </div>
            `).join('');
        }
        
        // =============================
        // SISTEMA DE SENHAS
        // =============================
        
        function loadPasswords() {
            passwords = {
                'dynamic-password': systemInfo.dynamicPassword,
                'pdv-password': 'AdmPwd20',
                'default-password': 'AdmPwd6333',
                'sql-password': 'PoliSystemsapwd',
                'sql-domain-password': 'PoliSystemsapwd123'
            };
            
            updatePasswordsDisplay();
        }
        
        function updatePasswordsDisplay() {
            const grid = document.getElementById('passwords-grid');
            if (!grid) return;
            
            const passwordItems = [
                { id: 'dynamic-password', label: 'AdmPwd (Data)', value: passwords['dynamic-password'] },
                { id: 'pdv-password', label: 'PDV', value: passwords['pdv-password'] },
                { id: 'default-password', label: 'Padrão', value: passwords['default-password'] },
                { id: 'sql-password', label: 'SQL', value: passwords['sql-password'] },
                { id: 'sql-domain-password', label: 'SQL Domínio', value: passwords['sql-domain-password'] }
            ];
            
            grid.innerHTML = passwordItems.map(item => `
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <label class="block text-sm font-medium text-gray-700 mb-2">${item.label}:</label>
                    <div class="flex justify-between items-center bg-white p-3 rounded border">
                        <span id="${item.id}" class="font-mono password-hidden" data-password="${item.value}">
                            ${'•'.repeat(item.value.length)}
                        </span>
                        <div class="flex gap-1">
                            <button onclick="togglePasswordVisibility('${item.id}')" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-eye" id="${item.id}-eye"></i>
                            </button>
                            <button onclick="copyPassword('${item.id}')" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-copy"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Campo do nome do banco SQL
            grid.innerHTML += `
                <div class="bg-gray-50 p-4 rounded-lg border">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nome Banco SQL:</label>
                    <input type="text" id="sql-db-name" class="w-full p-3 border rounded bg-white" placeholder="Digite o nome do banco">
                </div>
            `;
        }
        
        // =============================
        // FUNÇÕES DE UTILIDADE
        // =============================
        
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text).then(() => {
                    showToast('Copiado para a área de transferência!', 'success');
                }).catch(() => {
                    fallbackCopyTextToClipboard(text);
                });
            } else {
                fallbackCopyTextToClipboard(text);
            }
        }
        
        function fallbackCopyTextToClipboard(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                document.execCommand('copy');
                showToast('Copiado para a área de transferência!', 'success');
            } catch (err) {
                showToast('Erro ao copiar texto', 'error');
            }
            
            document.body.removeChild(textArea);
        }
        
        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            const colors = {
                success: 'bg-green-600',
                error: 'bg-red-600',
                warning: 'bg-yellow-600',
                info: 'bg-blue-600'
            };
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-triangle',
                warning: 'fa-exclamation-circle',
                info: 'fa-info-circle'
            };
            
            toast.className = `fixed top-4 right-4 ${colors[type]} text-white px-6 py-3 rounded-lg shadow-2xl z-50 transform transition-all duration-300 translate-x-full`;
            toast.innerHTML = `
                <div class="flex items-center">
                    <i class="fas ${icons[type]} mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            
            document.body.appendChild(toast);
            
            setTimeout(() => toast.classList.remove('translate-x-full'), 100);
            
            setTimeout(() => {
                toast.classList.add('translate-x-full');
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }
        
        // =============================
        // PWA
        // =============================
        
        function setupPWA() {
            // Service Worker
            if ('serviceWorker' in navigator) {
                const swCode = `
                    const CACHE_NAME = 'sistema-gerenciador-v1';
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME).then(cache => {
                                return cache.addAll(['/']);
                            })
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request).then(response => {
                                return response || fetch(event.request);
                            })
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swURL = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swURL)
                    .then(() => console.log('Service Worker registrado'))
                    .catch(error => console.log('Erro no Service Worker:', error));
            }
            
            // PWA Install Prompt
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                pwaPrompt = e;
                
                setTimeout(() => {
                    const banner = document.getElementById('install-banner');
                    if (banner) {
                        banner.classList.add('show');
                    }
                }, 3000);
            });
            
            window.addEventListener('appinstalled', () => {
                const banner = document.getElementById('install-banner');
                if (banner) {
                    banner.classList.remove('show');
                }
                showToast('Aplicativo instalado com sucesso!', 'success');
            });
        }
        
        function installPWA() {
            if (pwaPrompt) {
                pwaPrompt.prompt();
                pwaPrompt.userChoice.then((result) => {
                    if (result.outcome === 'accepted') {
                        console.log('PWA instalado');
                    }
                    pwaPrompt = null;
                });
            }
            dismissInstallBanner();
        }
        
        function dismissInstallBanner() {
            const banner = document.getElementById('install-banner');
            if (banner) {
                banner.classList.remove('show');
            }
        }
        
        // =============================
        // CONTROLES DE ADMINISTRADOR
        // =============================
        
        function setupAdminControls() {
            const adminControls = document.getElementById('admin-controls');
            const importBtn = document.getElementById('import-sites-btn');
            const adminOnlyElements = document.querySelectorAll('.admin-only');
            
            if (currentUser && currentUser.role !== 'admin') {
                if (adminControls) adminControls.style.display = 'none';
                if (importBtn) importBtn.style.display = 'none';
                adminOnlyElements.forEach(el => el.classList.remove('show'));
            } else {
                if (adminControls) adminControls.style.display = 'block';
                if (importBtn) importBtn.style.display = 'inline-block';
                adminOnlyElements.forEach(el => el.classList.add('show'));
            }
        }
        
        // =============================
        // NAVEGAÇÃO E TABS
        // =============================
        
        function openTab(evt, tabName) {
            const tabcontents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabcontents.length; i++) {
                tabcontents[i].classList.remove('active');
            }
            
            const tablinks = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tablinks.length; i++) {
                tablinks[i].classList.remove('border-blue-600', 'text-blue-600');
                tablinks[i].classList.add('border-transparent', 'text-gray-600');
            }
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.remove('border-transparent', 'text-gray-600');
            evt.currentTarget.classList.add('border-blue-600', 'text-blue-600');
        }
        
        function openBottomTab(tab) {
            switch(tab) {
                case 'tools':
                    showToast('Use as abas acima para acessar as ferramentas', 'info');
                    break;
                case 'database':
                    document.getElementById('db-modal').classList.remove('hidden');
                    break;
                case 'downloads':
                    document.getElementById('downloads-modal').classList.remove('hidden');
                    loadDownloads();
                    break;
                case 'sites':
                    document.getElementById('sites-modal').classList.remove('hidden');
                    loadSites();
                    break;
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }
        
        function toggleQueryMenu() {
            const menu = document.getElementById('query-menu');
            const menuItems = menu.querySelectorAll('.menu-item');
            
            if (menu.style.display === 'none' || !menu.style.display) {
                menu.style.display = 'block';
                setTimeout(() => {
                    menuItems.forEach((item, index) => {
                        setTimeout(() => {
                            item.classList.add('show');
                        }, index * 100);
                    });
                }, 50);
            } else {
                menuItems.forEach((item, index) => {
                    setTimeout(() => {
                        item.classList.remove('show');
                    }, index * 50);
                });
                setTimeout(() => {
                    menu.style.display = 'none';
                }, menuItems.length * 50 + 200);
            }
        }
        
        // =============================
        // CARREGAMENTO DE DADOS
        // =============================
        
        function loadAllData() {
            loadMenus();
            loadNotes();
            loadQueries();
            loadDownloads();
            loadSites();
            loadUsers();            loadAttendanceNotes();
            loadTasks();
            loadPersonalTasks();
            loadPersonalSchedules();
            loadAssignedTasks();
            loadUserSchedules();
            updateCalendar();
            updateScheduleBoard();
            updateAgendaStats();
            populateUserSelects();
        }
        
        function loadMenus() {
            const savedMenus = localStorage.getItem('menus');
            if (savedMenus) {
                menus = JSON.parse(savedMenus);
                displayMenus();
            }
        }
        
        function loadNotes() {
            const savedNotes = localStorage.getItem('notes');
            if (savedNotes) {
                notes = JSON.parse(savedNotes);
                displayNotes();
            }
        }
        
        function loadQueries() {
            const savedQueries = localStorage.getItem('savedQueries');
            if (savedQueries) {
                this.savedQueries = JSON.parse(savedQueries);
                displayQueries();
                updateQuerySelect();
            }
        }
        
        function loadDownloads() {
            const savedDownloads = localStorage.getItem('downloads');
            if (savedDownloads) {
                downloads = JSON.parse(savedDownloads);
                displayDownloads();
            }
        }
        
        function loadSites() {
            const savedSites = localStorage.getItem('sites');
            if (savedSites) {
                sites = JSON.parse(savedSites);
            } else {
                // Sites padrão
                sites = [
                    { id: 1, name: 'Google', url: 'https://www.google.com', createdAt: new Date().toISOString() },
                    { id: 2, name: 'GitHub', url: 'https://github.com', createdAt: new Date().toISOString() },
                    { id: 3, name: 'Stack Overflow', url: 'https://stackoverflow.com', createdAt: new Date().toISOString() }
                ];
                localStorage.setItem('sites', JSON.stringify(sites));
            }
            displaySites();
        }
        
        // =============================
        // FUNÇÕES DE EXIBIÇÃO
        // =============================
        
        function displayMenus() {
            const container = document.getElementById('menu-list');
            if (!container) return;
            
            container.innerHTML = menus.map(menu => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded border">
                    <div>
                        <strong>${menu.name}</strong>: ${menu.text}
                    </div>
                    <button onclick="removeMenu(${menu.id})" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function displayNotes() {
            const container = document.getElementById('notes-list');
            if (!container) return;
            
            container.innerHTML = notes.map(note => `
                <div class="p-3 bg-gray-50 rounded border">
                    <div class="flex justify-between items-center mb-2">
                        <strong>${note.title}</strong>
                        <button onclick="removeNote(${note.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="text-sm text-gray-700 whitespace-pre-wrap">${note.content}</div>
                    <div class="text-xs text-gray-500 mt-2">${new Date(note.createdAt).toLocaleString('pt-BR')}</div>
                </div>
            `).join('');
        }
        
        function displayQueries() {
            const container = document.getElementById('saved-queries');
            if (!container) return;
            
            container.innerHTML = savedQueries.map(query => `
                <div class="p-3 bg-gray-50 rounded border">
                    <div class="flex justify-between items-center mb-2">
                        <strong>${query.name}</strong>
                        <div class="flex gap-2">
                            <button onclick="loadQueryToEditor(${query.id})" class="text-blue-600 hover:text-blue-800">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="removeQuery(${query.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-sm text-gray-700 font-mono bg-white p-2 rounded border max-h-20 overflow-y-auto">${query.sql}</div>
                    <div class="text-xs text-gray-500 mt-2">${new Date(query.createdAt).toLocaleString('pt-BR')}</div>
                </div>
            `).join('');
        }
        
        function displayDownloads() {
            const container = document.getElementById('downloads-list');
            if (!container) return;
            
            container.innerHTML = downloads.map(download => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded border">
                    <div>
                        <div class="font-medium">${download.name}</div>
                        <div class="text-sm text-gray-600">${download.url || 'Arquivo local'}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="downloadFile('${download.url || download.dataUrl}', '${download.name}')" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-download"></i>
                        </button>
                        <button onclick="removeDownload(${download.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function displaySites() {
            const container = document.getElementById('sites-list');
            if (!container) return;
            
            container.innerHTML = sites.map(site => `
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded border">
                    <div>
                        <div class="font-medium">${site.name}</div>
                        <div class="text-sm text-gray-600">${site.url}</div>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="window.open('${site.url}', '_blank')" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-external-link-alt"></i>
                        </button>
                        ${currentUser && currentUser.role === 'admin' ? `
                            <button onclick="removeSite(${site.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash"></i>
                            </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }
        
        // =============================
        // FUNÇÕES DE MENU
        // =============================
        
        function addMenu() {
            const name = document.getElementById('menu-name').value.trim();
            const text = document.getElementById('menu-text').value.trim();
            
            if (!name || !text) {
                showToast('Preencha todos os campos', 'warning');
                return;
            }
            
            const menu = {
                id: Date.now(),
                name,
                text,
                createdAt: new Date().toISOString()
            };
            
            menus.push(menu);
            localStorage.setItem('menus', JSON.stringify(menus));
            
            document.getElementById('menu-name').value = '';
            document.getElementById('menu-text').value = '';
            
            displayMenus();
            showToast('Menu adicionado com sucesso!', 'success');
        }
        
        function removeMenu(id) {
            if (confirm('Tem certeza que deseja remover este menu?')) {
                menus = menus.filter(menu => menu.id !== id);
                localStorage.setItem('menus', JSON.stringify(menus));
                displayMenus();
                showToast('Menu removido!', 'success');
            }
        }
        
        // =============================
        // FUNÇÕES DE ANOTAÇÕES
        // =============================
        
        function saveNote() {
            const title = document.getElementById('note-title').value.trim();
            const content = document.getElementById('notes-area').value.trim();
            
            if (!title || !content) {
                showToast('Preencha o título e o conteúdo', 'warning');
                return;
            }
            
            const note = {
                id: Date.now(),
                title,
                content,
                createdAt: new Date().toISOString()
            };
            
            notes.push(note);
            localStorage.setItem('notes', JSON.stringify(notes));
            
            document.getElementById('note-title').value = '';
            document.getElementById('notes-area').value = '';
            
            displayNotes();
            showToast('Anotação salva com sucesso!', 'success');
        }
        
        function removeNote(id) {
            if (confirm('Tem certeza que deseja remover esta anotação?')) {
                notes = notes.filter(note => note.id !== id);
                localStorage.setItem('notes', JSON.stringify(notes));
                displayNotes();
                showToast('Anotação removida!', 'success');
            }
        }
        
        // =============================
        // FUNÇÕES DE CONSULTAS SQL
        // =============================
        
        function saveQuery() {
            const name = document.getElementById('query-name').value.trim();
            const sql = document.getElementById('sql-query').value.trim();
            
            if (!name || !sql) {
                showToast('Preencha o nome e a consulta', 'warning');
                return;
            }
            
            const query = {
                id: Date.now(),
                name,
                sql,
                createdAt: new Date().toISOString()
            };
            
            savedQueries.push(query);
            localStorage.setItem('savedQueries', JSON.stringify(savedQueries));
            
            document.getElementById('query-name').value = '';
            document.getElementById('sql-query').value = '';
            
            displayQueries();
            updateQuerySelect();
            showToast('Consulta salva com sucesso!', 'success');
        }
        
        function removeQuery(id) {
            if (confirm('Tem certeza que deseja remover esta consulta?')) {
                savedQueries = savedQueries.filter(query => query.id !== id);
                localStorage.setItem('savedQueries', JSON.stringify(savedQueries));
                displayQueries();
                updateQuerySelect();
                showToast('Consulta removida!', 'success');
            }
        }
        
        function loadQueryToEditor(id) {
            const query = savedQueries.find(q => q.id === id);
            if (query) {
                document.getElementById('sql-query').value = query.sql;
                showToast('Consulta carregada no editor!', 'success');
            }
        }
        
        function updateQuerySelect() {
            const select = document.getElementById('saved-query-select');
            if (!select) return;
            
            select.innerHTML = '<option value="">Selecionar consulta salva...</option>' +
                savedQueries.map(query => `<option value="${query.id}">${query.name}</option>`).join('');
        }
        
        // =============================
        // FUNÇÕES XML
        // =============================
        
        function validateXML() {
            const xmlContent = document.getElementById('xml-content').value.trim();
            const resultDiv = document.getElementById('xml-result');
            
            if (!xmlContent) {
                showToast('Cole o conteúdo XML primeiro', 'warning');
                return;
            }
            
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlContent, "text/xml");
                
                const parserError = xmlDoc.querySelector('parsererror');
                if (parserError) {
                    throw new Error(parserError.textContent);
                }
                
                resultDiv.innerHTML = `
                    <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            <span class="text-green-800 font-semibold">XML válido!</span>
                        </div>
                        <div class="text-sm text-green-700 mt-2">
                            O XML foi validado com sucesso. Estrutura correta encontrada.
                        </div>
                    </div>
                `;
                resultDiv.classList.remove('hidden');
                showToast('XML validado com sucesso!', 'success');
                
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="p-4 bg-red-50 border border-red-200 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                            <span class="text-red-800 font-semibold">XML inválido!</span>
                        </div>
                        <div class="text-sm text-red-700 mt-2">
                            <strong>Erro:</strong> ${error.message}
                        </div>
                    </div>
                `;
                resultDiv.classList.remove('hidden');
                showToast('XML contém erros!', 'error');
            }
        }
        
        function formatXML() {
            const xmlContent = document.getElementById('xml-content').value.trim();
            
            if (!xmlContent) {
                showToast('Cole o conteúdo XML primeiro', 'warning');
                return;
            }
            
            try {
                const parser = new DOMParser();
                const xmlDoc = parser.parseFromString(xmlContent, "text/xml");
                
                const serializer = new XMLSerializer();
                let formattedXML = serializer.serializeToString(xmlDoc);
                
                // Formatação básica
                formattedXML = formattedXML.replace(/></g, '>\n<');
                
                document.getElementById('xml-content').value = formattedXML;
                showToast('XML formatado!', 'success');
                
            } catch (error) {
                showToast('Erro ao formatar XML: ' + error.message, 'error');
            }
        }
        
        // =============================
        // FUNÇÕES DE DOWNLOADS
        // =============================
        
        function addDownload() {
            const name = document.getElementById('download-name').value.trim();
            const url = document.getElementById('download-url').value.trim();
            const fileInput = document.getElementById('upload-file');
            
            if (!name) {
                showToast('Digite um nome para o download', 'warning');
                return;
            }
            
            if (url) {
                // Download por URL
                const download = {
                    id: Date.now(),
                    name,
                    url,
                    type: 'url',
                    createdAt: new Date().toISOString()
                };
                
                downloads.push(download);
                localStorage.setItem('downloads', JSON.stringify(downloads));
                showToast('Download adicionado!', 'success');
                
            } else if (fileInput.files.length > 0) {
                // Upload de arquivo
                Array.from(fileInput.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const download = {
                            id: Date.now() + index,
                            name: file.name,
                            dataUrl: e.target.result,
                            type: 'file',
                            size: file.size,
                            createdAt: new Date().toISOString()
                        };
                        
                        downloads.push(download);
                        localStorage.setItem('downloads', JSON.stringify(downloads));
                        displayDownloads();
                    };
                    reader.readAsDataURL(file);
                });
                
                showToast('Arquivos adicionados!', 'success');
            } else {
                showToast('Digite uma URL ou selecione um arquivo', 'warning');
                return;
            }
            
            document.getElementById('download-name').value = '';
            document.getElementById('download-url').value = '';
            fileInput.value = '';
            
            displayDownloads();
        }
        
        function downloadFile(url, filename) {
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            link.target = '_blank';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showToast('Download iniciado!', 'success');
        }
        
        function removeDownload(id) {
            if (confirm('Tem certeza que deseja remover este download?')) {
                downloads = downloads.filter(download => download.id !== id);
                localStorage.setItem('downloads', JSON.stringify(downloads));
                displayDownloads();
                showToast('Download removido!', 'success');
            }
        }
        
        function clearAllDownloads() {
            if (confirm('Tem certeza que deseja limpar todos os downloads?')) {
                downloads = [];
                localStorage.setItem('downloads', JSON.stringify(downloads));
                displayDownloads();
                showToast('Todos os downloads foram removidos!', 'success');
            }
        }
        
        // =============================
        // FUNÇÕES DE SITES
        // =============================
        
        function addSite() {
            const name = document.getElementById('site-name').value.trim();
            const url = document.getElementById('site-url').value.trim();
            
            if (!name || !url) {
                showToast('Preencha todos os campos', 'warning');
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                showToast('URL deve começar com http:// ou https://', 'warning');
                return;
            }
            
            const site = {
                id: Date.now(),
                name,
                url,
                createdAt: new Date().toISOString()
            };
            
            sites.push(site);
            localStorage.setItem('sites', JSON.stringify(sites));
            
            document.getElementById('site-name').value = '';
            document.getElementById('site-url').value = '';
            
            displaySites();
            showToast('Site adicionado com sucesso!', 'success');
        }
        
        function removeSite(id) {
            if (confirm('Tem certeza que deseja remover este site?')) {
                sites = sites.filter(site => site.id !== id);
                localStorage.setItem('sites', JSON.stringify(sites));
                displaySites();
                showToast('Site removido!', 'success');
            }
        }
        
        function exportSites() {
            const dataStr = JSON.stringify(sites, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'sites-uteis.json';
            link.click();
            
            URL.revokeObjectURL(url);
            showToast('Sites exportados!', 'success');
        }
        
        function importSites() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const importedSites = JSON.parse(e.target.result);
                        
                        if (Array.isArray(importedSites)) {
                            sites = [...sites, ...importedSites.map(site => ({
                                ...site,
                                id: Date.now() + Math.random()
                            }))];
                            
                            localStorage.setItem('sites', JSON.stringify(sites));
                            displaySites();
                            showToast('Sites importados com sucesso!', 'success');
                        } else {
                            showToast('Arquivo de formato inválido', 'error');
                        }
                    } catch (error) {
                        showToast('Erro ao importar arquivo', 'error');
                    }
                };
                reader.readAsText(file);
            };
            
            input.click();
        }
        
        // =============================
        // FUNÇÕES DE BANCO DE DADOS
        // =============================
        
        function connectDatabase() {
            const type = document.getElementById('db-type').value;
            const host = document.getElementById('db-host').value.trim();
            const port = document.getElementById('db-port').value.trim();
            const dbName = document.getElementById('db-name-input').value.trim();
            const user = document.getElementById('db-user').value.trim();
            const password = document.getElementById('db-password-input').value;
            const btnText = document.querySelector('.connection-btn-text');
            
            if (!host || !user || !password) {
                showToast('Preencha os campos obrigatórios', 'warning');
                return;
            }
            
            btnText.innerHTML = '<span class="spinner"></span>Conectando...';
            updateConnectionStatus('connecting');
            
            // Simulação de conexão
            setTimeout(() => {
                currentConnection = {
                    type,
                    host,
                    port: port || (type === 'sql' ? '1433' : '5432'),
                    database: dbName,
                    user,
                    connected: true,
                    connectedAt: new Date().toISOString()
                };
                
                updateConnectionStatus('connected');
                btnText.textContent = 'Conectar';
                
                showToast('Conectado ao banco de dados!', 'success');
                closeModal('db-modal');
                
            }, 2000 + Math.random() * 2000);
        }
        
        function testConnection() {
            const host = document.getElementById('db-host').value.trim();
            const user = document.getElementById('db-user').value.trim();
            const password = document.getElementById('db-password-input').value;
            const resultDiv = document.getElementById('connection-test-result');
            
            if (!host || !user || !password) {
                showToast('Preencha os campos obrigatórios', 'warning');
                return;
            }
            
            resultDiv.innerHTML = `
                <div class="p-3 bg-blue-50 border border-blue-200 rounded-lg">
                    <div class="flex items-center">
                        <span class="spinner mr-2"></span>
                        <span class="text-blue-800">Testando conexão...</span>
                    </div>
                </div>
            `;
            resultDiv.classList.remove('hidden');
            
            // Simulação de teste
            setTimeout(() => {
                const success = Math.random() > 0.3; // 70% de chance de sucesso
                
                if (success) {
                    resultDiv.innerHTML = `
                        <div class="p-3 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-600 mr-2"></i>
                                <span class="text-green-800">Conexão bem-sucedida!</span>
                            </div>
                        </div>
                    `;
                    showToast('Conexão testada com sucesso!', 'success');
                } else {
                    resultDiv.innerHTML = `
                        <div class="p-3 bg-red-50 border border-red-200 rounded-lg">
                            <div class="flex items-center">
                                <i class="fas fa-exclamation-triangle text-red-600 mr-2"></i>
                                <span class="text-red-800">Falha na conexão!</span>
                            </div>
                            <div class="text-sm text-red-700 mt-1">
                                Verifique as credenciais e tente novamente.
                            </div>
                        </div>
                    `;
                    showToast('Falha no teste de conexão', 'error');
                }
            }, 1500 + Math.random() * 1500);
        }
        
        function updateConnectionStatus(status) {
            connectionStatus = status;
            const indicator = document.getElementById('connection-indicator');
            const text = document.getElementById('connection-status-text');
            const executorIndicator = document.getElementById('executor-connection-indicator');
            const executorText = document.getElementById('executor-connection-text');
            
            const configs = {
                connected: {
                    class: 'status-connected',
                    text: 'Conectado ao BD'
                },
                connecting: {
                    class: 'status-connecting',
                    text: 'Conectando...'
                },
                disconnected: {
                    class: 'status-disconnected',
                    text: 'Sistema ativo'
                }
            };
            
            const config = configs[status];
            
            [indicator, executorIndicator].forEach(el => {
                if (el) {
                    el.className = 'connection-status ' + config.class;
                }
            });
            
            [text, executorText].forEach(el => {
                if (el) {
                    el.textContent = config.text;
                }
            });
        }
        
        // =============================
        // EXECUTOR DE QUERIES
        // =============================
        
        function openQueryExecutor() {
            document.getElementById('query-executor-modal').classList.remove('hidden');
            updateQuerySelect();
            toggleQueryMenu();
        }
        
        function executeQuery() {
            const query = document.getElementById('execute-query').value.trim();
            const executeBtn = document.getElementById('execute-btn');
            const resultsDiv = document.getElementById('query-results');
            const statsSpan = document.getElementById('query-stats');
            
            if (!query) {
                showToast('Digite uma consulta SQL', 'warning');
                return;
            }
            
            if (!currentConnection) {
                showToast('Conecte-se ao banco de dados primeiro', 'warning');
                return;
            }
            
            executeBtn.innerHTML = '<span class="spinner"></span>Executando...';
            
            const startTime = Date.now();
            
            // Simulação de execução
            setTimeout(() => {
                const executionTime = Date.now() - startTime;
                const results = simulateQueryResults(query);
                
                displayQueryResults(results, executionTime);
                executeBtn.innerHTML = '<i class="fas fa-play mr-2"></i>Executar';
                
                statsSpan.textContent = `Executado em ${executionTime}ms - ${results.length} registro(s)`;
                
                if (results.length > 0) {
                    document.getElementById('export-btn').style.display = 'inline-block';
                }
                
                showToast('Consulta executada com sucesso!', 'success');
                
            }, 1000 + Math.random() * 2000);
        }
        
        function simulateQueryResults(query) {
            const lowerQuery = query.toLowerCase().trim();
            
            if (lowerQuery.includes('select')) {
                // Dados de exemplo
                return [
                    { id: 1, nome: 'João Silva', email: 'joao@example.com', data_criacao: '2024-01-15' },
                    { id: 2, nome: 'Maria Santos', email: 'maria@example.com', data_criacao: '2024-01-16' },
                    { id: 3, nome: 'Pedro Oliveira', email: 'pedro@example.com', data_criacao: '2024-01-17' }
                ];
            } else if (lowerQuery.includes('insert')) {
                return [{ message: 'Registro inserido com sucesso', rowsAffected: 1 }];
            } else if (lowerQuery.includes('update')) {
                return [{ message: 'Registros atualizados', rowsAffected: Math.floor(Math.random() * 5) + 1 }];
            } else if (lowerQuery.includes('delete')) {
                return [{ message: 'Registros excluídos', rowsAffected: Math.floor(Math.random() * 3) + 1 }];
            } else {
                return [{ message: 'Comando executado com sucesso' }];
            }
        }
        
        function displayQueryResults(results, executionTime) {
            const resultsDiv = document.getElementById('query-results');
            
            if (!results || results.length === 0) {
                resultsDiv.innerHTML = `
                    <div class="p-4 text-center text-gray-500">
                        <i class="fas fa-info-circle mr-2"></i>
                        Nenhum resultado encontrado
                    </div>
                `;
                return;
            }
            
            if (results[0].message) {
                // Resultado de comando (INSERT, UPDATE, DELETE)
                resultsDiv.innerHTML = `
                    <div class="p-4 bg-green-50 border border-green-200 rounded">
                        <div class="flex items-center">
                            <i class="fas fa-check-circle text-green-600 mr-2"></i>
                            <span class="text-green-800 font-semibold">${results[0].message}</span>
                        </div>
                        ${results[0].rowsAffected ? `
                            <div class="text-sm text-green-700 mt-1">
                                Linhas afetadas: ${results[0].rowsAffected}
                            </div>
                        ` : ''}
                    </div>
                `;
            } else {
                // Resultado de SELECT
                const columns = Object.keys(results[0]);
                
                resultsDiv.innerHTML = `
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    ${columns.map(col => `
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                            ${col}
                                        </th>
                                    `).join('')}
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                ${results.map(row => `
                                    <tr>
                                        ${columns.map(col => `
                                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                                                ${row[col] || ''}
                                            </td>
                                        `).join('')}
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;
            }
        }
        
        function loadSavedQuery() {
            const select = document.getElementById('saved-query-select');
            const queryId = parseInt(select.value);
            
            if (!queryId) {
                showToast('Selecione uma consulta', 'warning');
                return;
            }
            
            const query = savedQueries.find(q => q.id === queryId);
            if (query) {
                document.getElementById('execute-query').value = query.sql;
                showToast('Consulta carregada!', 'success');
            }
        }
        
        function formatQuerySQL() {
            const textarea = document.getElementById('execute-query');
            let sql = textarea.value.trim();
            
            if (!sql) {
                showToast('Digite uma consulta SQL primeiro', 'warning');
                return;
            }
            
            // Formatação básica do SQL
            sql = sql.replace(/\s+/g, ' ') // Remove espaços extras
                     .replace(/,/g, ',\n    ') // Quebra linhas após vírgulas
                     .replace(/\bFROM\b/gi, '\nFROM')
                     .replace(/\bWHERE\b/gi, '\nWHERE')
                     .replace(/\bAND\b/gi, '\n  AND')
                     .replace(/\bOR\b/gi, '\n  OR')
                     .replace(/\bORDER BY\b/gi, '\nORDER BY')
                     .replace(/\bGROUP BY\b/gi, '\nGROUP BY')
                     .replace(/\bHAVING\b/gi, '\nHAVING')
                     .replace(/\bJOIN\b/gi, '\nJOIN')
                     .replace(/\bLEFT JOIN\b/gi, '\nLEFT JOIN')
                     .replace(/\bRIGHT JOIN\b/gi, '\nRIGHT JOIN')
                     .replace(/\bINNER JOIN\b/gi, '\nINNER JOIN');
            
            textarea.value = sql;
            showToast('SQL formatado!', 'success');
        }
        
        function clearQuery() {
            if (confirm('Tem certeza que deseja limpar a consulta?')) {
                document.getElementById('execute-query').value = '';
                document.getElementById('query-results').innerHTML = `
                    <div class="p-4 text-gray-500 text-center">
                        <i class="fas fa-database mr-2"></i>Os resultados da consulta aparecerão aqui...
                    </div>
                `;
                document.getElementById('query-stats').textContent = '';
                document.getElementById('export-btn').style.display = 'none';
                showToast('Consulta limpa!', 'success');
            }
        }
        
        function exportResults() {
            // Simulação de exportação CSV
            const csvContent = "id,nome,email,data_criacao\n1,João Silva,joao@example.com,2024-01-15\n2,Maria Santos,maria@example.com,2024-01-16";
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'resultados_query.csv';
            link.click();
            
            URL.revokeObjectURL(url);
            showToast('Resultados exportados!', 'success');
        }
        
        function reconnectDatabase() {
            document.getElementById('db-modal').classList.remove('hidden');
        }
        
        // =============================
        // EVENTOS DE TECLADO
        // =============================
        
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + Enter para executar query
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (!document.getElementById('query-executor-modal').classList.contains('hidden')) {
                    executeQuery();
                }
            }
            
            // ESC para fechar modals
            if (e.key === 'Escape') {
                const modals = ['db-modal', 'query-executor-modal', 'downloads-modal', 'sites-modal'];
                modals.forEach(modalId => {
                    const modal = document.getElementById(modalId);
                    if (modal && !modal.classList.contains('hidden')) {
                        modal.classList.add('hidden');
                    }
                });
            }
        });
        
        // =============================
        // GERENCIAMENTO DE USUÁRIOS
        // =============================
        
        function createUser() {
            const name = document.getElementById('new-user-name').value.trim();
            const username = document.getElementById('new-user-username').value.trim();
            const password = document.getElementById('new-user-password').value;
            const role = document.getElementById('new-user-role').value;
            
            if (!name || !username || !password) {
                showToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }
            
            if (users.find(u => u.username === username)) {
                showToast('Nome de usuário já existe', 'error');
                return;
            }
            
            const permissions = {
                menus: document.getElementById('perm-menus').checked,
                xml: document.getElementById('perm-xml').checked,
                notes: document.getElementById('perm-notes').checked,
                sql: document.getElementById('perm-sql').checked,
                database: document.getElementById('perm-database').checked,
                downloads: document.getElementById('perm-downloads').checked,
                sites: document.getElementById('perm-sites').checked,
                attendance: document.getElementById('perm-attendance').checked
            };
            
            const newUser = {
                id: Date.now(),
                fullName: name,
                username,
                password,
                role,
                permissions,
                createdAt: new Date().toISOString(),
                createdBy: currentUser.username
            };
            
            users.push(newUser);
            localStorage.setItem('users', JSON.stringify(users));
            
            // Limpar formulário
            document.getElementById('new-user-name').value = '';
            document.getElementById('new-user-username').value = '';
            document.getElementById('new-user-password').value = '';
            document.getElementById('new-user-role').value = 'user';
            
            // Resetar checkboxes
            document.querySelectorAll('#users-tab input[type="checkbox"]').forEach(cb => cb.checked = true);
            
            displayUsers();
            showToast('Usuário criado com sucesso!', 'success');
        }
        
        function loadUsers() {
            const savedUsers = localStorage.getItem('users');
            if (savedUsers) {
                users = JSON.parse(savedUsers);
                displayUsers();
            }
        }
        
        function displayUsers() {
            const container = document.getElementById('users-list');
            if (!container) return;
            
            container.innerHTML = users.map(user => `
                <div class="p-4 bg-gray-50 border rounded-lg">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-2">
                                <strong class="text-lg">${user.fullName}</strong>
                                <span class="px-2 py-1 text-xs rounded-full ${user.role === 'admin' ? 'bg-red-100 text-red-800' : 'bg-blue-100 text-blue-800'}">
                                    ${user.role === 'admin' ? 'Administrador' : 'Usuário'}
                                </span>
                            </div>
                            <div class="text-sm text-gray-600 mb-2">
                                <strong>Usuário:</strong> ${user.username}
                            </div>
                            <div class="text-sm text-gray-600 mb-2">
                                <strong>Criado em:</strong> ${new Date(user.createdAt).toLocaleString('pt-BR')}
                            </div>
                            ${user.createdBy ? `
                                <div class="text-sm text-gray-600 mb-2">
                                    <strong>Criado por:</strong> ${user.createdBy}
                                </div>
                            ` : ''}
                            ${user.permissions ? `
                                <div class="text-sm text-gray-600">
                                    <strong>Permissões:</strong>
                                    <div class="flex flex-wrap gap-1 mt-1">
                                        ${Object.entries(user.permissions).filter(([key, value]) => value).map(([key]) => `
                                            <span class="px-2 py-1 text-xs bg-green-100 text-green-800 rounded">
                                                ${getPermissionName(key)}
                                            </span>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                        <div class="flex gap-2">
                            <button onclick="editUser(${user.id})" class="text-blue-600 hover:text-blue-800" title="Editar">
                                <i class="fas fa-edit"></i>
                            </button>
                            ${user.id !== 1 ? `
                                <button onclick="deleteUser(${user.id})" class="text-red-600 hover:text-red-800" title="Excluir">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function getPermissionName(key) {
            const names = {
                menus: 'Menus',
                xml: 'XML',
                notes: 'Anotações',
                sql: 'SQL',
                database: 'Banco',
                downloads: 'Downloads',
                sites: 'Sites',
                attendance: 'Atendimento'
            };
            return names[key] || key;
        }
        
        function editUser(userId) {
            const user = users.find(u => u.id === userId);
            if (!user) return;
            
            // Implementar modal de edição (simplificado)
            const newName = prompt('Nome completo:', user.fullName);
            if (newName && newName !== user.fullName) {
                user.fullName = newName;
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers();
                showToast('Usuário atualizado!', 'success');
            }
        }
        
        function deleteUser(userId) {
            if (confirm('Tem certeza que deseja excluir este usuário?')) {
                users = users.filter(u => u.id !== userId);
                localStorage.setItem('users', JSON.stringify(users));
                displayUsers();
                showToast('Usuário excluído!', 'success');
            }
        }
        
        // =============================
        // ATENDIMENTO EXTERNO
        // =============================
        
        function saveAttendanceNote() {
            const cnpj = document.getElementById('client-cnpj').value.trim();
            const title = document.getElementById('attendance-title').value.trim();
            const notes = document.getElementById('attendance-notes').value.trim();
            
            if (!cnpj || !title || !notes) {
                showToast('Preencha todos os campos', 'warning');
                return;
            }
            
            // Validação básica de CNPJ (formato)
            const cnpjRegex = /^\d{2}\.\d{3}\.\d{3}\/\d{4}-\d{2}$/;
            if (!cnpjRegex.test(cnpj)) {
                // Tentar formatar automaticamente
                const cleanCnpj = cnpj.replace(/\D/g, '');
                if (cleanCnpj.length === 14) {
                    const formattedCnpj = cleanCnpj.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
                    document.getElementById('client-cnpj').value = formattedCnpj;
                } else {
                    showToast('CNPJ deve ter 14 dígitos', 'error');
                    return;
                }
            }
            
            const attendanceNote = {
                id: Date.now(),
                clientCnpj: document.getElementById('client-cnpj').value,
                title,
                notes,
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };
            
            attendanceNotes.push(attendanceNote);
            localStorage.setItem('attendanceNotes', JSON.stringify(attendanceNotes));
            
            // Limpar formulário
            document.getElementById('client-cnpj').value = '';
            document.getElementById('attendance-title').value = '';
            document.getElementById('attendance-notes').value = '';
            
            displayAttendanceNotes();
            showToast('Atendimento salvo com sucesso!', 'success');
        }
        
        function loadAttendanceNotes() {
            const saved = localStorage.getItem('attendanceNotes');
            if (saved) {
                attendanceNotes = JSON.parse(saved);
                displayAttendanceNotes();
            }
        }
        
        function displayAttendanceNotes() {
            const container = document.getElementById('attendance-notes-list');
            if (!container) return;
            
            container.innerHTML = attendanceNotes.map(note => `
                <div class="p-3 bg-gray-50 border rounded-lg">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <strong class="text-sm">${note.title}</strong>
                            <div class="text-xs text-gray-600">CNPJ: ${note.clientCnpj}</div>
                        </div>
                        <button onclick="removeAttendanceNote(${note.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                    <div class="text-sm text-gray-700 mb-2 whitespace-pre-wrap">${note.notes}</div>
                    <div class="text-xs text-gray-500">
                        Por: ${note.createdBy} - ${new Date(note.createdAt).toLocaleString('pt-BR')}
                    </div>
                </div>
            `).join('');
        }
        
        function removeAttendanceNote(id) {
            if (confirm('Tem certeza que deseja remover esta anotação?')) {
                attendanceNotes = attendanceNotes.filter(note => note.id !== id);
                localStorage.setItem('attendanceNotes', JSON.stringify(attendanceNotes));
                displayAttendanceNotes();
                showToast('Anotação removida!', 'success');
            }
        }
        
        // Formatação automática do CNPJ
        document.addEventListener('DOMContentLoaded', function() {
            const cnpjInput = document.getElementById('client-cnpj');
            if (cnpjInput) {
                cnpjInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length <= 14) {
                        value = value.replace(/(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})/, '$1.$2.$3/$4-$5');
                        e.target.value = value;
                    }
                });
            }
        });
        
        // =============================
        // SISTEMA DE TAREFAS (TO-DO)
        // =============================
        
        function createTask() {
            const title = document.getElementById('task-title').value.trim();
            const description = document.getElementById('task-description').value.trim();
            const filesInput = document.getElementById('task-files');
            
            if (!title) {
                showToast('Digite um título para a tarefa', 'warning');
                return;
            }
            
            const task = {
                id: Date.now(),
                title,
                description,
                status: 'todo',
                attachments: [],
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };
            
            // Processar arquivos anexados
            if (filesInput.files.length > 0) {
                Array.from(filesInput.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        task.attachments.push({
                            id: Date.now() + index,
                            name: file.name,
                            type: file.type,
                            size: file.size,
                            dataUrl: e.target.result
                        });
                        
                        if (task.attachments.length === filesInput.files.length) {
                            saveTask(task);
                        }
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                saveTask(task);
            }
            
            // Limpar formulário
            document.getElementById('task-title').value = '';
            document.getElementById('task-description').value = '';
            filesInput.value = '';
        }
        
        function saveTask(task) {
            tasks.push(task);
            localStorage.setItem('tasks', JSON.stringify(tasks));
            displayTasks();
            showToast('Tarefa criada com sucesso!', 'success');
        }
        
        function loadTasks() {
            const saved = localStorage.getItem('tasks');
            if (saved) {
                tasks = JSON.parse(saved);
                displayTasks();
            }
        }
        
        function displayTasks() {
            const todoColumn = document.getElementById('todo-column');
            const progressColumn = document.getElementById('progress-column');
            const doneColumn = document.getElementById('done-column');
            
            if (!todoColumn || !progressColumn || !doneColumn) return;
            
            // Limpar colunas
            todoColumn.innerHTML = '';
            progressColumn.innerHTML = '';
            doneColumn.innerHTML = '';
            
            tasks.forEach(task => {
                const taskElement = createTaskElement(task);
                
                switch(task.status) {
                    case 'todo':
                        todoColumn.appendChild(taskElement);
                        break;
                    case 'progress':
                        progressColumn.appendChild(taskElement);
                        break;
                    case 'done':
                        doneColumn.appendChild(taskElement);
                        break;
                }
            });
        }
        
        function createTaskElement(task) {
            const div = document.createElement('div');
            div.className = `task-card bg-white p-3 rounded-lg border shadow-sm status-${task.status}`;
            div.draggable = true;
            div.dataset.taskId = task.id;
            
            div.innerHTML = `
                <div class="flex justify-between items-start mb-2">
                    <strong class="text-sm">${task.title}</strong>
                    <button onclick="removeTask(${task.id})" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-trash text-xs"></i>
                    </button>
                </div>
                ${task.description ? `<div class="text-xs text-gray-600 mb-2">${task.description}</div>` : ''}
                ${task.attachments.length > 0 ? `
                    <div class="flex flex-wrap gap-1 mb-2">
                        ${task.attachments.map(att => `
                            <div class="relative">
                                ${att.type.startsWith('image/') ? `
                                    <img src="${att.dataUrl}" alt="${att.name}" class="attachment-preview" onclick="viewAttachment('${att.dataUrl}', '${att.name}')">
                                ` : `
                                    <div class="w-8 h-8 bg-gray-200 rounded flex items-center justify-center text-xs cursor-pointer" onclick="downloadAttachment('${att.dataUrl}', '${att.name}')" title="${att.name}">
                                        <i class="fas fa-file"></i>
                                    </div>
                                `}
                            </div>
                        `).join('')}
                    </div>
                ` : ''}
                <div class="text-xs text-gray-500">
                    ${task.createdBy} - ${new Date(task.createdAt).toLocaleDateString('pt-BR')}
                </div>
            `;
            
            // Event listeners para drag and drop
            div.addEventListener('dragstart', handleDragStart);
            div.addEventListener('dragend', handleDragEnd);
            
            return div;
        }
        
        function handleDragStart(e) {
            draggedElement = this;
            this.classList.add('dragging');
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('text/html', this.outerHTML);
        }
        
        function handleDragEnd(e) {
            this.classList.remove('dragging');
            draggedElement = null;
        }
        
        function allowDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }
        
        function drop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            if (draggedElement) {
                const taskId = parseInt(draggedElement.dataset.taskId);
                const newStatus = e.currentTarget.dataset.status;
                
                updateTaskStatus(taskId, newStatus);
                draggedElement = null;
            }
        }
        
        function updateTaskStatus(taskId, newStatus) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                task.status = newStatus;
                localStorage.setItem('tasks', JSON.stringify(tasks));
                displayTasks();
                showToast('Status da tarefa atualizado!', 'success');
            }
        }
        
        function removeTask(id) {
            if (confirm('Tem certeza que deseja remover esta tarefa?')) {
                tasks = tasks.filter(task => task.id !== id);
                localStorage.setItem('tasks', JSON.stringify(tasks));
                displayTasks();
                showToast('Tarefa removida!', 'success');
            }
        }
        
        function viewAttachment(dataUrl, name) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50';
            modal.innerHTML = `
                <div class="max-w-4xl max-h-4xl p-4">
                    <div class="bg-white rounded-lg p-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="font-semibold">${name}</h3>
                            <button onclick="this.closest('.fixed').remove()" class="text-gray-600 hover:text-gray-800">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <img src="${dataUrl}" alt="${name}" class="max-w-full max-h-96 mx-auto">
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        function downloadAttachment(dataUrl, name) {
            const link = document.createElement('a');
            link.href = dataUrl;
            link.download = name;
            link.click();
        }
        
        // Event listeners para drag and drop nas colunas
        document.addEventListener('DOMContentLoaded', function() {
            const columns = document.querySelectorAll('[data-status]');
            columns.forEach(column => {
                column.addEventListener('dragover', allowDrop);
                column.addEventListener('drop', drop);
                column.addEventListener('dragleave', function() {
                    this.classList.remove('drag-over');
                });
            });
        });
                // =============================
        // SISTEMA DE AGENDA PESSOAL
        // =============================
        
        function addPersonalTask() {
            const title = document.getElementById('personal-task-title').value.trim();
            const description = document.getElementById('personal-task-description').value.trim();
            const date = document.getElementById('personal-task-date').value;
            const time = document.getElementById('personal-task-time').value;
            const priority = document.getElementById('personal-task-priority').value;
            
            if (!title || !date) {
                showToast('Preencha pelo menos o título e a data', 'warning');
                return;
            }
            
            const task = {
                id: Date.now(),
                title,
                description,
                date,
                time,
                priority,
                completed: false,
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            personalTasks.push(task);
            localStorage.setItem('personalTasks', JSON.stringify(personalTasks));
            
            // Limpar formulário
            document.getElementById('personal-task-title').value = '';
            document.getElementById('personal-task-description').value = '';
            document.getElementById('personal-task-date').value = '';
            document.getElementById('personal-task-time').value = '';
            document.getElementById('personal-task-priority').value = 'media';
            
            displayPersonalTasks();
            updateCalendar();
            updateAgendaStats();
            showToast('Tarefa adicionada à agenda!', 'success');
        }
        
        function loadPersonalTasks() {
            const saved = localStorage.getItem('personalTasks');
            if (saved) {
                const allTasks = JSON.parse(saved);
                personalTasks = allTasks.filter(task => task.userId === currentUser.id);
                displayPersonalTasks();
            }
        }
        
        function displayPersonalTasks() {
            const container = document.getElementById('personal-tasks-list');
            if (!container) return;
            
            const sortedTasks = personalTasks
                .sort((a, b) => {
                    const priorityOrder = { urgente: 4, alta: 3, media: 2, baixa: 1 };
                    if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
                        return priorityOrder[b.priority] - priorityOrder[a.priority];
                    }
                    return new Date(a.date + ' ' + (a.time || '00:00')) - new Date(b.date + ' ' + (b.time || '00:00'));
                });
            
            container.innerHTML = sortedTasks.map(task => {
                const priorityColors = {
                    baixa: 'bg-gray-100 text-gray-800',
                    media: 'bg-blue-100 text-blue-800',
                    alta: 'bg-yellow-100 text-yellow-800',
                    urgente: 'bg-red-100 text-red-800'
                };
                
                const priorityIcons = {
                    baixa: 'fa-flag',
                    media: 'fa-flag',
                    alta: 'fa-exclamation',
                    urgente: 'fa-exclamation-triangle'
                };
                
                const taskDate = new Date(task.date + ' ' + (task.time || '00:00'));
                const isOverdue = taskDate < new Date() && !task.completed;
                
                return `
                    <div class="p-3 bg-gray-50 border rounded-lg ${task.completed ? 'opacity-60' : ''} ${isOverdue ? 'border-red-300 bg-red-50' : ''}">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <input type="checkbox" ${task.completed ? 'checked' : ''} onchange="togglePersonalTask(${task.id})" class="rounded">
                                    <strong class="text-sm ${task.completed ? 'line-through text-gray-500' : ''}">${task.title}</strong>
                                    <span class="px-2 py-1 text-xs rounded-full ${priorityColors[task.priority]}">
                                        <i class="fas ${priorityIcons[task.priority]} mr-1"></i>${task.priority.toUpperCase()}
                                    </span>
                                </div>
                                ${task.description ? `<div class="text-xs text-gray-600 mb-1">${task.description}</div>` : ''}
                                <div class="text-xs text-gray-500">
                                    <i class="fas fa-calendar mr-1"></i>${new Date(task.date).toLocaleDateString('pt-BR')}
                                    ${task.time ? `<i class="fas fa-clock ml-2 mr-1"></i>${task.time}` : ''}
                                </div>
                            </div>
                            <button onclick="removePersonalTask(${task.id})" class="text-red-600 hover:text-red-800">
                                <i class="fas fa-trash text-sm"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function togglePersonalTask(taskId) {
            const task = personalTasks.find(t => t.id === taskId);
            if (task) {
                task.completed = !task.completed;
                localStorage.setItem('personalTasks', JSON.stringify(getAllPersonalTasks()));
                displayPersonalTasks();
                updateAgendaStats();
                showToast(task.completed ? 'Tarefa concluída!' : 'Tarefa reaberta!', 'success');
            }
        }
        
        function removePersonalTask(taskId) {
            if (confirm('Tem certeza que deseja remover esta tarefa?')) {
                personalTasks = personalTasks.filter(t => t.id !== taskId);
                localStorage.setItem('personalTasks', JSON.stringify(getAllPersonalTasks()));
                displayPersonalTasks();
                updateCalendar();
                updateAgendaStats();
                showToast('Tarefa removida!', 'success');
            }
        }
        
        function getAllPersonalTasks() {
            const saved = localStorage.getItem('personalTasks');
            const allTasks = saved ? JSON.parse(saved) : [];
            // Remove tarefas do usuário atual e adiciona as atualizadas
            const otherUsersTasks = allTasks.filter(task => task.userId !== currentUser.id);
            return [...otherUsersTasks, ...personalTasks];
        }
        
        // =============================
        // SISTEMA DE ESCALA DE TRABALHO
        // =============================
        
        function saveDefaultSchedule() {
            const startTime = document.getElementById('default-start-time').value;
            const endTime = document.getElementById('default-end-time').value;
            
            if (!startTime || !endTime) {
                showToast('Preencha os horários de entrada e saída', 'warning');
                return;
            }
            
            defaultWorkSchedule = { start: startTime, end: endTime };
            localStorage.setItem(`defaultSchedule_${currentUser.id}`, JSON.stringify(defaultWorkSchedule));
            showToast('Horário padrão salvo!', 'success');
        }
        
        function addScheduleEntry() {
            const date = document.getElementById('schedule-date').value;
            const startTime = document.getElementById('schedule-start').value;
            const endTime = document.getElementById('schedule-end').value;
            const notes = document.getElementById('schedule-notes').value.trim();
            
            if (!date || !startTime || !endTime) {
                showToast('Preencha a data e horários', 'warning');
                return;
            }
            
            const schedule = {
                id: Date.now(),
                date,
                startTime,
                endTime,
                notes,
                userId: currentUser.id,
                createdAt: new Date().toISOString()
            };
            
            // Remove entrada existente para a mesma data
            personalSchedules = personalSchedules.filter(s => s.date !== date);
            personalSchedules.push(schedule);
            
            localStorage.setItem('personalSchedules', JSON.stringify(personalSchedules));
            
            // Limpar formulário
            document.getElementById('schedule-date').value = '';
            document.getElementById('schedule-start').value = '';
            document.getElementById('schedule-end').value = '';
            document.getElementById('schedule-notes').value = '';
            
            displayPersonalSchedules();
            updateScheduleBoard();
            updateAgendaStats();
            showToast('Escala adicionada!', 'success');
        }
        
        function loadPersonalSchedules() {
            const saved = localStorage.getItem('personalSchedules');
            if (saved) {
                const allSchedules = JSON.parse(saved);
                personalSchedules = allSchedules.filter(schedule => schedule.userId === currentUser.id);
                displayPersonalSchedules();
                
                // Carregar horário padrão
                const savedDefault = localStorage.getItem(`defaultSchedule_${currentUser.id}`);
                if (savedDefault) {
                    defaultWorkSchedule = JSON.parse(savedDefault);
                    document.getElementById('default-start-time').value = defaultWorkSchedule.start;
                    document.getElementById('default-end-time').value = defaultWorkSchedule.end;
                }
            }
        }
        
        function displayPersonalSchedules() {
            const container = document.getElementById('personal-schedule-list');
            if (!container) return;
            
            const sortedSchedules = personalSchedules
                .sort((a, b) => new Date(a.date) - new Date(b.date));
            
            container.innerHTML = sortedSchedules.map(schedule => `
                <div class="p-3 bg-gray-50 border rounded-lg">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <div class="flex items-center gap-2 mb-1">
                                <i class="fas fa-calendar text-green-600"></i>
                                <strong class="text-sm">${new Date(schedule.date).toLocaleDateString('pt-BR')}</strong>
                            </div>
                            <div class="text-sm text-gray-600 mb-1">
                                <i class="fas fa-clock text-blue-600 mr-1"></i>
                                ${schedule.startTime} - ${schedule.endTime}
                            </div>
                            ${schedule.notes ? `<div class="text-xs text-gray-500">${schedule.notes}</div>` : ''}
                        </div>
                        <button onclick="removeScheduleEntry(${schedule.id})" class="text-red-600 hover:text-red-800">
                            <i class="fas fa-trash text-sm"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function removeScheduleEntry(scheduleId) {
            if (confirm('Tem certeza que deseja remover esta escala?')) {
                personalSchedules = personalSchedules.filter(s => s.id !== scheduleId);
                localStorage.setItem('personalSchedules', JSON.stringify(getAllPersonalSchedules()));
                displayPersonalSchedules();
                updateScheduleBoard();
                showToast('Escala removida!', 'success');
            }
        }
        
        function getAllPersonalSchedules() {
            const saved = localStorage.getItem('personalSchedules');
            const allSchedules = saved ? JSON.parse(saved) : [];
            const otherUsersSchedules = allSchedules.filter(schedule => schedule.userId !== currentUser.id);
            return [...otherUsersSchedules, ...personalSchedules];
        }
        
        // =============================
        // SISTEMA ADMINISTRATIVO DE AGENDA
        // =============================
        
        function populateUserSelects() {
            const assignSelect = document.getElementById('assign-user-select');
            const scheduleSelect = document.getElementById('schedule-user-select');
            
            if (!assignSelect || !scheduleSelect) return;
            
            const userOptions = users.filter(u => u.id !== currentUser.id).map(user => 
                `<option value="${user.id}">${user.fullName} (${user.username})</option>`
            ).join('');
            
            assignSelect.innerHTML = '<option value="">Selecionar usuário...</option>' + userOptions;
            scheduleSelect.innerHTML = '<option value="">Selecionar usuário...</option>' + userOptions;
        }
        
        function assignTaskToUser() {
            const userId = parseInt(document.getElementById('assign-user-select').value);
            const title = document.getElementById('assign-task-title').value.trim();
            const description = document.getElementById('assign-task-description').value.trim();
            const date = document.getElementById('assign-task-date').value;
            const time = document.getElementById('assign-task-time').value;
            const priority = document.getElementById('assign-task-priority').value;
            
            if (!userId || !title || !date) {
                showToast('Preencha os campos obrigatórios', 'warning');
                return;
            }
            
            const user = users.find(u => u.id === userId);
            if (!user) {
                showToast('Usuário não encontrado', 'error');
                return;
            }
            
            const task = {
                id: Date.now(),
                title,
                description,
                date,
                time,
                priority,
                completed: false,
                userId: userId,
                assignedBy: currentUser.id,
                assignedByName: currentUser.fullName,
                createdAt: new Date().toISOString()
            };
            
            assignedTasks.push(task);
            localStorage.setItem('assignedTasks', JSON.stringify(assignedTasks));
            
            // Adicionar às tarefas pessoais do usuário
            const allPersonalTasks = JSON.parse(localStorage.getItem('personalTasks') || '[]');
            allPersonalTasks.push(task);
            localStorage.setItem('personalTasks', JSON.stringify(allPersonalTasks));
            
            // Limpar formulário
            document.getElementById('assign-user-select').value = '';
            document.getElementById('assign-task-title').value = '';
            document.getElementById('assign-task-description').value = '';
            document.getElementById('assign-task-date').value = '';
            document.getElementById('assign-task-time').value = '';
            document.getElementById('assign-task-priority').value = 'media';
            
            updateAgendaStats();
            showToast(`Tarefa atribuída para ${user.fullName}!`, 'success');
        }
        
        function setUserSchedule() {
            const userId = parseInt(document.getElementById('schedule-user-select').value);
            const date = document.getElementById('admin-schedule-date').value;
            const startTime = document.getElementById('admin-schedule-start').value;
            const endTime = document.getElementById('admin-schedule-end').value;
            const notes = document.getElementById('admin-schedule-notes').value.trim();
            
            if (!userId || !date || !startTime || !endTime) {
                showToast('Preencha todos os campos obrigatórios', 'warning');
                return;
            }
            
            const user = users.find(u => u.id === userId);
            if (!user) {
                showToast('Usuário não encontrado', 'error');
                return;
            }
            
            const schedule = {
                id: Date.now(),
                date,
                startTime,
                endTime,
                notes,
                userId: userId,
                setBy: currentUser.id,
                setByName: currentUser.fullName,
                createdAt: new Date().toISOString()
            };
            
            if (!userSchedules[userId]) {
                userSchedules[userId] = [];
            }
            
            // Remove entrada existente para a mesma data
            userSchedules[userId] = userSchedules[userId].filter(s => s.date !== date);
            userSchedules[userId].push(schedule);
            
            localStorage.setItem('userSchedules', JSON.stringify(userSchedules));
            
            // Adicionar às escalas pessoais do usuário
            const allPersonalSchedules = JSON.parse(localStorage.getItem('personalSchedules') || '[]');
            const existingIndex = allPersonalSchedules.findIndex(s => s.userId === userId && s.date === date);
            if (existingIndex >= 0) {
                allPersonalSchedules[existingIndex] = schedule;
            } else {
                allPersonalSchedules.push(schedule);
            }
            localStorage.setItem('personalSchedules', JSON.stringify(allPersonalSchedules));
            
            // Limpar formulário
            document.getElementById('schedule-user-select').value = '';
            document.getElementById('admin-schedule-date').value = '';
            document.getElementById('admin-schedule-start').value = '';
            document.getElementById('admin-schedule-end').value = '';
            document.getElementById('admin-schedule-notes').value = '';
            
            updateScheduleBoard();
            updateAgendaStats();
            showToast(`Escala definida para ${user.fullName}!`, 'success');
        }
        
        function loadAssignedTasks() {
            const saved = localStorage.getItem('assignedTasks');
            if (saved) {
                assignedTasks = JSON.parse(saved);
            }
        }
        
        function loadUserSchedules() {
            const saved = localStorage.getItem('userSchedules');
            if (saved) {
                userSchedules = JSON.parse(saved);
            }
        }
        
        // =============================
        // CALENDÁRIO E VISUALIZAÇÕES
        // =============================
        
        function updateCalendar() {
            const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho',
                               'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            
            const monthYearElement = document.getElementById('calendar-month-year');
            const calendarGrid = document.getElementById('calendar-grid');
            
            if (!monthYearElement || !calendarGrid) return;
            
            monthYearElement.textContent = `${monthNames[currentCalendarDate.getMonth()]} ${currentCalendarDate.getFullYear()}`;
            
            const firstDay = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth(), 1);
            const lastDay = new Date(currentCalendarDate.getFullYear(), currentCalendarDate.getMonth() + 1, 0);
            const startDate = new Date(firstDay);
            startDate.setDate(startDate.getDate() - firstDay.getDay());
            
            const dayNames = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb'];
            
            let calendarHTML = dayNames.map(day => 
                `<div class="font-semibold text-gray-700 p-2">${day}</div>`
            ).join('');
            
            const today = new Date();
            const currentDate = new Date(startDate);
            
            for (let i = 0; i < 42; i++) {
                const isCurrentMonth = currentDate.getMonth() === currentCalendarDate.getMonth();
                const isToday = currentDate.toDateString() === today.toDateString();
                const dateStr = currentDate.toISOString().split('T')[0];
                
                const tasksForDay = personalTasks.filter(task => task.date === dateStr).length;
                const schedulesForDay = personalSchedules.filter(schedule => schedule.date === dateStr).length;
                
                const hasEvents = tasksForDay > 0 || schedulesForDay > 0;
                
                calendarHTML += `
                    <div class="p-1 h-16 border border-gray-100 ${isCurrentMonth ? 'bg-white' : 'bg-gray-50'} ${isToday ? 'bg-blue-100 ring-2 ring-blue-300' : ''} ${hasEvents ? 'border-blue-300' : ''} cursor-pointer hover:bg-gray-50"
                         onclick="showDayDetails('${dateStr}')">
                        <div class="text-sm ${isCurrentMonth ? 'text-gray-900' : 'text-gray-400'} ${isToday ? 'font-bold text-blue-600' : ''}">
                            ${currentDate.getDate()}
                        </div>
                        ${hasEvents ? `
                            <div class="text-xs mt-1">
                                ${tasksForDay > 0 ? `<div class="bg-blue-500 text-white px-1 rounded text-xs">${tasksForDay} tarefa${tasksForDay > 1 ? 's' : ''}</div>` : ''}
                                ${schedulesForDay > 0 ? `<div class="bg-green-500 text-white px-1 rounded text-xs mt-1">Escala</div>` : ''}
                            </div>
                        ` : ''}
                    </div>
                `;
                
                currentDate.setDate(currentDate.getDate() + 1);
            }
            
            calendarGrid.innerHTML = calendarHTML;
        }
        
        function changeMonth(direction) {
            currentCalendarDate.setMonth(currentCalendarDate.getMonth() + direction);
            updateCalendar();
        }
        
        function goToToday() {
            currentCalendarDate = new Date();
            updateCalendar();
        }
        
        function showDayDetails(dateStr) {
            const tasksForDay = personalTasks.filter(task => task.date === dateStr);
            const schedulesForDay = personalSchedules.filter(schedule => schedule.date === dateStr);
            
            if (tasksForDay.length === 0 && schedulesForDay.length === 0) {
                showToast('Nenhum evento para este dia', 'info');
                return;
            }
            
            let content = `<h4 class="font-semibold mb-2">Eventos para ${new Date(dateStr).toLocaleDateString('pt-BR')}</h4>`;
            
            if (schedulesForDay.length > 0) {
                content += '<h5 class="font-medium text-green-600 mb-1">Escala:</h5>';
                schedulesForDay.forEach(schedule => {
                    content += `<div class="text-sm mb-1">⏰ ${schedule.startTime} - ${schedule.endTime}</div>`;
                });
            }
            
            if (tasksForDay.length > 0) {
                content += '<h5 class="font-medium text-blue-600 mb-1 mt-2">Tarefas:</h5>';
                tasksForDay.forEach(task => {
                    content += `<div class="text-sm mb-1">📋 ${task.title} ${task.time ? `(${task.time})` : ''}</div>`;
                });
            }
            
            showToast(content, 'info');
        }
        
        function updateScheduleBoard() {
            const container = document.getElementById('schedule-board');
            if (!container) return;
            
            const today = new Date();
            const next7Days = [];
            
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(date.getDate() + i);
                next7Days.push(date.toISOString().split('T')[0]);
            }
            
            container.innerHTML = next7Days.map(dateStr => {
                const dayName = new Date(dateStr).toLocaleDateString('pt-BR', { weekday: 'long', day: '2-digit', month: '2-digit' });
                
                // Buscar escalas de todos os usuários
                const allSchedules = JSON.parse(localStorage.getItem('personalSchedules') || '[]');
                const schedulesForDay = allSchedules.filter(schedule => schedule.date === dateStr);
                
                return `
                    <div class="border rounded-lg p-4 bg-gray-50">
                        <h4 class="font-semibold text-gray-800 mb-3 capitalize">${dayName}</h4>
                        ${schedulesForDay.length > 0 ? 
                            schedulesForDay.map(schedule => {
                                const user = users.find(u => u.id === schedule.userId);
                                return `
                                    <div class="flex justify-between items-center p-2 bg-white rounded border mb-2">
                                        <div>
                                            <div class="font-medium text-sm">${user ? user.fullName : 'Usuário desconhecido'}</div>
                                            <div class="text-xs text-gray-600">${schedule.startTime} - ${schedule.endTime}</div>
                                            ${schedule.notes ? `<div class="text-xs text-gray-500">${schedule.notes}</div>` : ''}
                                        </div>
                                        <div class="text-xs text-gray-500">
                                            ${schedule.setByName || 'Auto'}
                                        </div>
                                    </div>
                                `;
                            }).join('') :
                            '<div class="text-sm text-gray-500 italic">Nenhuma escala definida</div>'
                        }
                    </div>
                `;
            }).join('');
        }
        
        function updateAgendaStats() {
            const allPersonalTasks = JSON.parse(localStorage.getItem('personalTasks') || '[]');
            const activeTasks = allPersonalTasks.filter(task => !task.completed);
            
            const today = new Date().toISOString().split('T')[0];
            const allSchedules = JSON.parse(localStorage.getItem('personalSchedules') || '[]');
            const usersWorkingToday = new Set(allSchedules.filter(s => s.date === today).map(s => s.userId)).size;
            
            const overdueTasks = activeTasks.filter(task => {
                const taskDate = new Date(task.date);
                const now = new Date();
                return taskDate < now;
            });
            
            const totalActiveElement = document.getElementById('total-active-tasks');
            const usersWorkingElement = document.getElementById('users-working-today');
            const overdueElement = document.getElementById('overdue-tasks');
            
            if (totalActiveElement) totalActiveElement.textContent = activeTasks.length;
            if (usersWorkingElement) usersWorkingElement.textContent = usersWorkingToday;
            if (overdueElement) overdueElement.textContent = overdueTasks.length;
        }
        
        function generateAgendaReport() {
            const allPersonalTasks = JSON.parse(localStorage.getItem('personalTasks') || '[]');
            const allSchedules = JSON.parse(localStorage.getItem('personalSchedules') || '[]');
            
            let reportData = 'RELATÓRIO DE AGENDA - ' + new Date().toLocaleString('pt-BR') + '\n\n';
            
            reportData += '=== ESTATÍSTICAS GERAIS ===\n';
            reportData += `Total de tarefas ativas: ${allPersonalTasks.filter(t => !t.completed).length}\n`;
            reportData += `Total de tarefas concluídas: ${allPersonalTasks.filter(t => t.completed).length}\n`;
            reportData += `Total de escalas definidas: ${allSchedules.length}\n\n`;
            
            reportData += '=== USUÁRIOS ===\n';
            users.forEach(user => {
                const userTasks = allPersonalTasks.filter(t => t.userId === user.id);
                const userSchedules = allSchedules.filter(s => s.userId === user.id);
                
                reportData += `${user.fullName} (${user.username}):\n`;
                reportData += `  - Tarefas: ${userTasks.length} (${userTasks.filter(t => !t.completed).length} ativas)\n`;
                reportData += `  - Escalas: ${userSchedules.length}\n\n`;
            });
            
            const blob = new Blob([reportData], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `relatorio_agenda_${new Date().toISOString().split('T')[0]}.txt`;
            link.click();
            URL.revokeObjectURL(url);
            
            showToast('Relatório gerado e baixado!', 'success');
        }

        // =============================
        // EVENTOS DE CONEXÃO
        // =============================
        
        window.addEventListener('online', () => {
            systemInfo.onLine = true;
            updateSystemInfoDisplay();
            showToast('Conexão restaurada', 'success');
        });
        
        window.addEventListener('offline', () => {
            systemInfo.onLine = false;
            updateSystemInfoDisplay();
            showToast('Conexão perdida', 'warning');
        });
        
        // =============================
        // ATUALIZAÇÃO PERIÓDICA
        // =============================
        
        setInterval(() => {
            systemInfo.currentTime = new Date().toLocaleString('pt-BR');
            updateSystemInfoDisplay();
        }, 60000); // Atualizar a cada minuto
    </script>
    
    <script>window.onload=function(){var d=document.createElement("div");d.id="aionspaceLoadFinished";document.body.appendChild(d);};</script>
<script>window.onload=function(){var d=document.createElement("div");d.id="aionspaceLoadFinished";document.body.appendChild(d);};</script><script>window.onload=function(){var d=document.createElement("div");d.id="aionspaceLoadFinished";document.body.appendChild(d);};</script><script>window.onload=function(){var d=document.createElement("div");d.id="aionspaceLoadFinished";document.body.appendChild(d);};</script>



</body></html>